<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="description" content="$ELK - A Solana memecoin rooted in existential philosophy. The antlers are heavy. We carry them together.">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <meta property="og:title" content="$ELK - The Burden We Carry Together">
    <meta property="og:description" content="We are carried through life by a series of sublimationsâ€”fleeting release valves for the pressure of being.">
    <meta property="og:image" content="https://raw.githubusercontent.com/exelkonsol/elk/main/newpreview.png">
    <meta property="og:type" content="website">

    <title>ðŸ¦Œ $ELK - The Burden We Carry Together</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* Removed global transition * { ... } to fix mobile glitching */

        html {
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            scroll-padding-top: 80px;
        }

        body {
            background-color: #000000;
            color: #e5e5e5;
            overflow-x: hidden;
            position: relative;
            font-family: 'Crimson Text', serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Global Background */
        .global-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/elk2.png');
            background-size: cover;
            background-position: center;
            filter: grayscale(100%) opacity(0.3) contrast(1.1);
            z-index: -10;
            transform: translateZ(0);
        }

        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.95) 100%),
                        linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.1) 20%, rgba(0,0,0,0.1) 80%, rgba(0,0,0,0.9) 100%);
            pointer-events: none;
            z-index: -5;
            transform: translateZ(0);
        }

        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            pointer-events: none;
            z-index: -4;
            transform: translateZ(0);
        }

        .noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            transform: translateZ(0);
        }

        .blur-fade {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: rgba(5, 5, 5, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .buy-btn {
            background: rgba(139, 0, 0, 0.2);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: rgba(255, 100, 100, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            user-select: none;
        }

        .buy-btn:hover {
            background: rgba(139, 0, 0, 0.4);
            border-color: rgba(220, 38, 38, 0.6);
            color: rgba(255, 150, 150, 1);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.3);
        }

        .buy-btn:active { transform: scale(0.98); }

        /* Quote Section - Fixed Mobile Layout */
        .quote-section { position: relative; overflow: hidden; }
        
        .quote-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/generatewisdom.png');
            background-size: cover;
            background-position: center;
            opacity: 0.25;
            filter: blur(0px) contrast(1.1);
            z-index: 0;
            mix-blend-mode: screen;
            transform: translateZ(0);
        }

        .quote-container {
            position: relative;
            z-index: 1;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 1.5rem;
            text-align: center;
        }

        .quote-text {
            font-family: 'Crimson Text', serif;
            font-style: italic;
            font-size: clamp(1.5rem, 5vw, 2.75rem);
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.95);
            max-width: 900px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.8s ease;
            text-shadow: 0 4px 30px rgba(0,0,0,1);
            margin: 2rem 0;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quote-text.visible { opacity: 1; transform: translateY(0); }

        .quote-btn-group button {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            user-select: none;
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .quote-btn-group button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .quote-btn-group button:active { transform: scale(0.95); }

        .mode-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
        }

        .mode-btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            touch-action: manipulation;
            user-select: none;
            min-height: 44px;
        }

        .mode-btn:hover, .mode-btn.active {
            border-color: rgba(139, 0, 0, 0.5);
            color: rgba(255,255,255,0.9);
            background: rgba(139, 0, 0, 0.1);
        }

        /* Hero Entrance Animation */
        @keyframes materialize {
            0% { opacity: 0; transform: scale(1.15) translateY(40px); filter: blur(12px); }
            100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); }
        }

        .hero-content {
            animation: materialize 1.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            will-change: transform, opacity, filter;
        }

        .hero-image {
            filter: blur(0px) brightness(0.9) contrast(1.05);
            transition: all 1.5s ease;
            object-fit: contain;
            mix-blend-mode: normal;
            opacity: 1;
            transform: translateZ(0);
            will-change: transform;
        }

        .mechanism-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.04);
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        .mechanism-card:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }

        .mechanism-card.voted {
            background: rgba(139, 0, 0, 0.1);
            border-color: rgba(139, 0, 0, 0.2);
        }

        .mechanism-card button { touch-action: manipulation; min-height: 44px; transition: opacity 0.3s ease; }

        /* Footer Background */
        .footer-bg-layer {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 100%; height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/logo.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: clamp(300px, 60vw, 800px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            filter: grayscale(0%) contrast(1.2);
        }

        /* Audio Player */
        .audio-player-container {
            position: relative;
            overflow: hidden;
        }

        #visualizer-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
        }

        /* Vinyl Record */
        .vinyl-record {
            position: relative;
            width: 220px; height: 220px;
            border-radius: 50%;
            background: repeating-radial-gradient(circle at center, #111 0px, #111 2px, #0a0a0a 3px, #0a0a0a 4px);
            box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 10px 30px rgba(0,0,0,0.8), inset 0 0 30px rgba(0,0,0,0.9);
            cursor: pointer;
            touch-action: manipulation;
            transform: translateZ(0);
        }

        .vinyl-label {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80px; height: 80px;
            border-radius: 50%;
            background: #000;
            border: 2px solid rgba(139, 0, 0, 0.3);
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
            pointer-events: none;
        }

        .vinyl-hole {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #000;
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 2;
            pointer-events: none;
        }

        .progress-container {
            position: relative;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            cursor: pointer;
            overflow: visible;
            touch-action: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(139,0,0,0.5), rgba(255,255,255,0.3));
            width: 0%;
            position: relative;
            border-radius: 2px;
            pointer-events: none;
        }

        .progress-handle {
            position: absolute;
            right: -6px; top: 50%;
            transform: translateY(-50%) scale(0);
            width: 12px; height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: transform 0.2s;
            pointer-events: none;
        }

        .progress-container:hover .progress-handle, 
        .progress-container:active .progress-handle { 
            transform: translateY(-50%) scale(1); 
        }

        .track-item {
            transition: background 0.2s ease, padding 0.2s ease;
            border-left: 2px solid transparent;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            min-height: 44px;
            display: flex;
            align-items: center;
        }

        .track-item::before {
            content: '';
            position: absolute; left: 0; top: 0;
            height: 100%; width: 3px;
            background: rgba(139, 0, 0, 0.5);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .track-item:hover { background: rgba(255,255,255,0.03); padding-left: 1rem; }
        .track-item.active { background: rgba(139, 0, 0, 0.05); border-left-color: rgba(139, 0, 0, 0.5); }
        .track-item.active::before { transform: scaleY(1); }

        .control-btn {
            transition: transform 0.2s, color 0.2s;
            touch-action: manipulation;
            min-height: 44px; min-width: 44px;
            display: inline-flex; align-items: center; justify-content: center;
            user-select: none;
        }

        .control-btn:hover { transform: scale(1.1); color: rgba(255,255,255,0.9); }
        .control-btn:active { transform: scale(0.95); }

        .play-btn-main {
            width: 60px; height: 60px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            touch-action: manipulation;
            user-select: none;
        }

        .play-btn-main:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
            box-shadow: 0 0 30px rgba(139,0,0,0.2);
        }

        /* Floating Button */
        #mute-toggle-btn {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px;
            border-radius: 50%;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 100;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.8);
            transition: transform 0.3s, border-color 0.3s;
            display: flex; align-items: center; justify-content: center;
            touch-action: manipulation;
            user-select: none;
            transform: translateZ(0);
        }

        #mute-toggle-btn:hover { transform: scale(1.1); border-color: rgba(255,255,255,0.5); }

        #mute-toggle-btn img.btn-art {
            position: absolute; width: 100%; height: 100%;
            object-fit: cover; opacity: 0.6;
            pointer-events: none;
        }

        .mute-icon-overlay {
            position: relative; z-index: 2;
            color: rgba(255,255,255,0.9);
            background: rgba(0,0,0,0.6);
            border-radius: 50%; padding: 4px;
            pointer-events: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        .text-balance { text-wrap: balance; }
        button:focus-visible, a:focus-visible { outline: 1px solid rgba(139, 0, 0, 0.5); outline-offset: 2px; }

        @media (max-width: 640px) {
            .vinyl-record { width: 160px; height: 160px; }
            .vinyl-label { width: 60px; height: 60px; }
            .quote-container { min-height: 400px; padding: 3rem 1rem; }
            #mute-toggle-btn { bottom: 16px; right: 16px; width: 50px; height: 50px; }
            .hero-image { width: 180px !important; height: 180px !important; }
            .quote-text { font-size: 1.5rem; }
        }

        @media (pointer: coarse) {
            .progress-container { height: 20px; margin: -8px 0; background: transparent; }
            .progress-container::before {
                content: ''; position: absolute; top: 8px; left: 0; right: 0;
                height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px;
            }
            .progress-fill { top: 8px; height: 4px; }
            .progress-handle { right: -8px; width: 16px; height: 16px; transform: translateY(-50%) scale(1); }
            .track-item { padding-top: 12px; padding-bottom: 12px; }
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
            .hero-content { opacity: 1; transform: none; filter: none; }
        }
    </style>
</head>
<body class="font-body antialiased selection:bg-white/10 selection:text-white relative">
    <div class="noise"></div>
    <div class="global-bg"></div>
    <div class="vignette"></div>
    <div class="bg-overlay"></div>
    
    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 blur-fade px-6 py-3 translate-y-full opacity-0 transition-all duration-500 z-[100] rounded-full border border-white/10">
        <span class="font-mono text-xs text-white/70 tracking-wider flex items-center gap-2">
            <i data-lucide="check" class="w-3 h-3"></i> <span id="toast-msg">COPIED</span>
        </span>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 blur-fade border-b-0 h-16 sm:h-20 flex items-center">
        <div class="w-full max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center">
                <a href="#" class="font-serif text-base sm:text-lg font-bold tracking-[0.3em] text-white/60 hover:text-white/90 transition-colors touch-manipulation">$ELK</a>
                <div class="hidden md:flex items-center gap-8 lg:gap-12 font-mono text-[10px] tracking-[0.3em] uppercase">
                    <a href="#mechanisms" class="text-white/20 hover:text-white/60 transition-colors duration-300 py-2">Mechanisms</a>
                    <a href="#manifesto" class="text-white/20 hover:text-white/60 transition-colors duration-300 py-2">Manifesto</a>
                    <a href="#soundscape" class="text-white/20 hover:text-white/60 transition-colors duration-300 py-2">Soundscape</a>
                </div>
                <!-- INCREASED OPACITY FOR CA BUTTON -->
                <button onclick="copyToClipboard('8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump', 'CA COPIED')" 
                        class="font-mono text-[8px] sm:text-[9px] text-white/60 hover:text-white/90 transition-all duration-500 tracking-wider uppercase border border-white/5 px-3 py-1.5 rounded hover:bg-white/5 active:scale-95 touch-manipulation min-h-[44px]">
                    <span class="hidden sm:inline">8DaLP...Gpump</span>
                    <span class="sm:hidden">CA</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Floating Play/Pause Button -->
    <div id="mute-toggle-btn" onclick="togglePlay()" role="button" aria-label="Toggle Play/Pause">
        <img id="btn-art" src="https://raw.githubusercontent.com/exelkonsol/elk/main/Before%20the%20Clearing.png" alt="Album Art" class="btn-art" decoding="async">
        <div class="mute-icon-overlay">
            <i id="mute-icon" data-lucide="volume-2" class="w-5 h-5"></i>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="relative min-h-screen flex items-center justify-center py-20 px-4 overflow-hidden">
        <div class="hero-content relative z-10 max-w-4xl mx-auto text-center w-full flex flex-col items-center">
            
            <div class="mb-6 sm:mb-8 w-full flex justify-center items-center relative">
                <img src="https://raw.githubusercontent.com/exelkonsol/elk/main/pumpfun.png" 
                     alt="$ELK Stag" 
                     width="400" 
                     height="400"
                     decoding="async"
                     class="hero-image w-[180px] h-[180px] sm:w-[240px] sm:h-[240px] md:w-[320px] md:h-[320px] lg:w-[400px] lg:h-[400px] mx-auto object-contain select-none">
            </div>

            <div class="space-y-6 sm:space-y-8 mb-12 sm:mb-16 max-w-4xl px-4 relative z-20">
                <p class="font-mono text-[8px] sm:text-[9px] tracking-[0.4em] sm:tracking-[0.5em] text-white/10 uppercase">Peter Wessel Zapffe // On The Tragic</p>

                <h1 class="font-serif text-xl sm:text-3xl md:text-5xl font-light text-white/60 leading-normal sm:leading-relaxed tracking-wide text-balance">
                    "We are carried through life by a series of 
                    <span class="text-white/90 italic">sublimations</span>â€”fleeting release valves 
                    for the pressure of being."
                </h1>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center items-center w-full px-8 relative z-20">
                <a href="https://pump.fun/coin/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump" 
                   class="buy-btn w-full sm:w-auto px-8 sm:px-10 py-3 sm:py-4 text-[10px] font-mono tracking-[0.2em] uppercase text-center rounded touch-manipulation">
                    BUY
                </a>
                <a href="https://x.com/i/communities/2014904566983094598" 
                   class="blur-fade w-full sm:w-auto px-8 sm:px-10 py-3 sm:py-4 text-[10px] font-mono tracking-[0.2em] text-white/40 hover:text-white/80 uppercase transition-all hover:scale-105 text-center rounded touch-manipulation">
                    Join The Silence
                </a>
                <a href="https://birdeye.so/solana/token/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump" 
                   class="blur-fade w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 text-[9px] font-mono tracking-[0.2em] text-white/30 hover:text-white/70 uppercase transition-all hover:scale-105 text-center rounded touch-manipulation">
                    Chart
                </a>
            </div>
        </div>
    </section>

    <!-- Four Mechanisms -->
    <section id="mechanisms" class="relative py-20 sm:py-32 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16 sm:mb-20 space-y-4">
                <span class="font-mono text-[9px] tracking-[0.5em] text-white/10 uppercase block">Survival Architecture</span>
                <h2 class="font-serif text-3xl sm:text-5xl font-light text-white/50">Four Mechanisms</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                <div class="mechanism-card p-6 sm:p-8 min-h-[300px] flex flex-col justify-between rounded-lg" data-mechanism="isolation">
                    <div>
                        <h3 class="font-serif text-2xl text-white/70 mb-4">Isolation</h3>
                        <p class="text-white/30 text-sm leading-relaxed mb-4">Remove tokens from circulation. Confine anxiety to manageable compartments.</p>
                        <p class="text-[10px] text-white/20 font-mono uppercase">Suppression through reduction</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono">Cast</span>
                            <span class="vote-count font-mono text-lg text-white/50" data-count="0">0</span>
                        </div>
                        <button onclick="vote('isolation')" class="w-full py-2 text-[10px] font-mono tracking-wider uppercase text-white/20 hover:text-white/60 border border-white/5 hover:border-white/20 transition-all opacity-0 hover:opacity-100 focus:opacity-100 touch-manipulation min-h-[44px]">Vote</button>
                    </div>
                </div>

                <div class="mechanism-card p-6 sm:p-8 min-h-[300px] flex flex-col justify-between rounded-lg" data-mechanism="anchoring">
                    <div>
                        <h3 class="font-serif text-2xl text-white/70 mb-4">Anchoring</h3>
                        <p class="text-white/30 text-sm leading-relaxed mb-4">Permanent liquidity. Fixed points preventing drift into the chaotic void.</p>
                        <p class="text-[10px] text-white/20 font-mono uppercase">Structure against entropy</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono">Cast</span>
                            <span class="vote-count font-mono text-lg text-white/50" data-count="0">0</span>
                        </div>
                        <button onclick="vote('anchoring')" class="w-full py-2 text-[10px] font-mono tracking-wider uppercase text-white/20 hover:text-white/60 border border-white/5 hover:border-white/20 transition-all opacity-0 hover:opacity-100 focus:opacity-100 touch-manipulation min-h-[44px]">Vote</button>
                    </div>
                </div>

                <div class="mechanism-card p-6 sm:p-8 min-h-[300px] flex flex-col justify-between rounded-lg" data-mechanism="distraction">
                    <div>
                        <h3 class="font-serif text-2xl text-white/70 mb-4">Distraction</h3>
                        <p class="text-white/30 text-sm leading-relaxed mb-4">Marketing, raids, content. Keep the mind moving against the abyss.</p>
                        <p class="text-[10px] text-white/20 font-mono uppercase">Motion against stillness</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono">Cast</span>
                            <span class="vote-count font-mono text-lg text-white/50" data-count="0">0</span>
                        </div>
                        <button onclick="vote('distraction')" class="w-full py-2 text-[10px] font-mono tracking-wider uppercase text-white/20 hover:text-white/60 border border-white/5 hover:border-white/20 transition-all opacity-0 hover:opacity-100 focus:opacity-100 touch-manipulation min-h-[44px]">Vote</button>
                    </div>
                </div>

                <div class="mechanism-card p-6 sm:p-8 min-h-[300px] flex flex-col justify-between rounded-lg" data-mechanism="sublimation">
                    <div>
                        <h3 class="font-serif text-2xl text-white/70 mb-4">Sublimation</h3>
                        <p class="text-white/30 text-sm leading-relaxed mb-4">Transform suffering into art. Philosophy as evolutionary bypass.</p>
                        <p class="text-[10px] text-white/20 font-mono uppercase">Pain becomes meaning</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono">Cast</span>
                            <span class="vote-count font-mono text-lg text-white/50" data-count="0">0</span>
                        </div>
                        <button onclick="vote('sublimation')" class="w-full py-2 text-[10px] font-mono tracking-wider uppercase text-white/20 hover:text-white/60 border border-white/5 hover:border-white/20 transition-all opacity-0 hover:opacity-100 focus:opacity-100 touch-manipulation min-h-[44px]">Vote</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Manifesto / Quote Generator Section -->
    <section id="manifesto" class="relative py-20 sm:py-32 px-4 sm:px-6">
        <div class="max-w-5xl mx-auto">
            <div class="quote-section blur-fade mb-10 rounded-xl border border-white/5">
                <div class="quote-bg"></div>
                <div class="quote-container">
                    <div class="mb-6 w-full text-center relative z-10">
                         <p class="font-mono text-[9px] tracking-[0.4em] text-white/20 uppercase">Echoes of the Present Void</p>
                    </div>
                    <div class="mode-selector mb-8 relative z-10">
                        <button class="mode-btn active" onclick="setMode('existential', this)" aria-pressed="true">EXISTENTIAL</button>
                        <button class="mode-btn" onclick="setMode('degen', this)" aria-pressed="false">DEGEN</button>
                        <button class="mode-btn" onclick="setMode('elk', this)" aria-pressed="false">ELK WISDOM</button>
                    </div>
                    <div id="quote-display" class="quote-text visible px-4 relative z-10">
                        "We built machines to save time, and now we kill time staring at them, waiting for something to happen."
                    </div>
                    <div class="quote-btn-group mt-auto flex gap-4 relative z-10">
                        <button onclick="generateQuote()" class="px-8 py-3 hover:bg-white/5 rounded border border-white/10 hover:border-white/30 uppercase tracking-widest text-[10px] transition-all active:scale-95 touch-manipulation min-h-[44px]">Generate Echo</button>
                        <button onclick="copyQuote()" class="px-4 py-3 hover:bg-white/5 rounded border border-white/10 hover:border-white/30 text-white/50 hover:text-white transition-all active:scale-95 touch-manipulation min-h-[44px] min-w-[44px]" aria-label="Copy Quote"><i data-lucide="copy" class="w-4 h-4"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Soundscape -->
    <section id="soundscape" class="relative py-20 sm:py-32 px-4 sm:px-6 min-h-[800px] overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/20 to-black/50 pointer-events-none"></div>
        
        <div class="max-w-5xl mx-auto h-full flex flex-col relative z-10">
            <div class="text-center mb-12 sm:mb-20 space-y-4">
                <span class="font-mono text-[9px] tracking-[0.5em] text-white/10 uppercase block">Auditory Space</span>
                <!-- RENAMED TITLE -->
                <h2 class="font-serif text-3xl sm:text-5xl font-light text-white/50">HYMNS FOR THE HERD</h2>
            </div>

            <!-- Audio Interface -->
            <div id="audio-interface" class="audio-player-container blur-fade p-6 sm:p-12 rounded-xl border border-white/5 relative bg-black/60">
                <canvas id="visualizer-canvas"></canvas>
                
                <div class="player-grid grid md:grid-cols-5 gap-8 md:gap-12 relative z-10">
                    
                    <!-- Left: Vinyl & Visuals -->
                    <div class="md:col-span-2 flex flex-col items-center justify-center">
                        <div class="vinyl-record" id="vinyl-disc" onclick="togglePlay()">
                            <div class="vinyl-label">
                                <img id="album-art-small" src="" alt="" class="w-full h-full object-cover opacity-80" decoding="async">
                            </div>
                            <div class="vinyl-hole"></div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <div id="track-status" class="font-mono text-[9px] tracking-widest text-white/20 uppercase">Paused</div>
                        </div>
                    </div>

                    <!-- Right: Controls -->
                    <div class="md:col-span-3 flex flex-col h-full justify-center space-y-6">
                        <div>
                            <h3 id="track-title" class="font-serif text-xl sm:text-2xl text-white/80 mb-1 leading-tight truncate">Before the Clearing</h3>
                            <p id="track-desc" class="text-white/30 text-xs sm:text-sm italic truncate">"The silence before revelation"</p>
                        </div>

                        <div class="space-y-2">
                            <div class="progress-container" id="progress-container">
                                <div class="progress-fill" id="progress-fill">
                                    <div class="progress-handle"></div>
                                </div>
                            </div>
                            <div class="flex justify-between text-[10px] font-mono text-white/30">
                                <span id="time-current">00:00</span>
                                <span id="time-total">00:00</span>
                            </div>
                        </div>

                        <div class="flex items-center justify-center gap-6">
                            <button onclick="toggleShuffle()" id="shuffle-btn" class="control-btn text-white/20 hover:text-white/60" aria-label="Shuffle"><i data-lucide="shuffle" class="w-4 h-4"></i></button>
                            <button onclick="prevTrack()" class="control-btn text-white/30 hover:text-white/80" aria-label="Previous"><i data-lucide="skip-back" class="w-6 h-6"></i></button>
                            <button onclick="togglePlay()" id="play-btn" class="play-btn-main" aria-label="Play/Pause"><i data-lucide="play" id="play-icon" class="w-6 h-6 text-white/80 ml-1"></i></button>
                            <button onclick="nextTrack()" class="control-btn text-white/30 hover:text-white/80" aria-label="Next"><i data-lucide="skip-forward" class="w-6 h-6"></i></button>
                            <button onclick="toggleRepeat()" id="repeat-btn" class="control-btn text-white/20 hover:text-white/60" aria-label="Repeat"><i data-lucide="repeat" class="w-4 h-4"></i></button>
                        </div>

                        <div class="flex-1 overflow-y-auto max-h-48 space-y-1 pr-2 custom-scrollbar" id="playlist">
                            <!-- JS Generated -->
                        </div>

                        <div class="flex items-center gap-3 px-2">
                            <i data-lucide="volume-2" class="w-4 h-4 text-white/20"></i>
                            <input type="range" min="0" max="100" value="60" class="flex-1 h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-white/30 hover:accent-white/50" oninput="setVolume(this.value)" aria-label="Volume">
                        </div>
                    </div>
                </div>

                <audio id="audio-player" preload="metadata" crossorigin="anonymous" playsinline webkit-playsinline></audio>
            </div>
        </div>
    </section>

    <!-- Footer - INCREASED VISIBILITY -->
    <footer class="relative py-16 sm:py-24 px-6 border-t border-white/5 bg-black overflow-hidden">
        <div class="footer-bg-layer z-0"></div>
        <div class="relative z-10 max-w-2xl mx-auto text-center space-y-12">
            <!-- Increased text opacity to white/60 -->
            <blockquote class="font-body text-white/60 text-sm sm:text-base leading-relaxed italic px-4">"The tragedy of man is that he is constituted to strive for goals he can never fully attain, and to seek answers he can never fully comprehend."</blockquote>
            <div class="flex justify-center gap-12">
                <a href="https://github.com/exelkonsol/elk" target="_blank" class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center" aria-label="GitHub"><i data-lucide="github" class="w-5 h-5"></i></a>
                <a href="https://x.com/ElkBurden" target="_blank" class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center" aria-label="Twitter"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                <a href="https://birdeye.so/solana/token/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump" target="_blank" class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center" aria-label="Chart"><i data-lucide="activity" class="w-5 h-5"></i></a>
            </div>
            <!-- Increased text opacity to white/30 -->
            <p class="font-mono text-[8px] text-white/30 tracking-[0.4em] uppercase">The Antlers Are Heavy // We Carry Them Together</p>
        </div>
    </footer>

    <script>
        // Prevent scroll jump on reload
        if (history.scrollRestoration) {
            history.scrollRestoration = 'manual';
        }

        lucide.createIcons();

        // Audio Context Handling
        let audioContextUnlocked = false;
        function unlockAudioContext() {
            if (audioContextUnlocked) return;
            const audio = document.getElementById('audio-player');
            if (typeof AudioContext !== 'undefined' && AudioContext.state === 'suspended') {
                AudioContext.resume().then(() => { audioContextUnlocked = true; });
            } else if (typeof webkitAudioContext !== 'undefined') {
                const ctx = new webkitAudioContext();
                if (ctx.state === 'suspended') ctx.resume();
                audioContextUnlocked = true;
            }
        }
        document.addEventListener('touchstart', unlockAudioContext, { once: true, passive: true });
        document.addEventListener('click', unlockAudioContext, { once: true });

        // Toast
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-y-full', 'opacity-0');
            if (navigator.vibrate) navigator.vibrate(10);
            setTimeout(() => t.classList.add('translate-y-full', 'opacity-0'), 2000);
        }

        function copyToClipboard(text, msg) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => showToast(msg)).catch(() => fallbackCopy(text, msg));
            } else {
                fallbackCopy(text, msg);
            }
        }
        
        function fallbackCopy(text, msg) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.cssText = "position:fixed;left:-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showToast(msg);
            } catch (err) {
                console.error('Fallback copy failed', err);
            }
            document.body.removeChild(textArea);
        }

        // Quotes
        const quotesExistential = ["We built machines to save time, and now we kill time staring at them, waiting for something to happen.", "Man is the only animal that refuses to be what he is.", "Anxiety is the dizziness of freedom.", "To live is to suffer, to survive is to find some meaning in the suffering.", "He who has a why to live can bear almost any how.", "We are condemned to be free.", "Existence precedes essence.", "The struggle itself towards the heights is enough to fill a man's heart.", "One must imagine Sisyphus happy.", "Hell is other people."];
        const quotesDegen = ["Buy high, sell low, cry in the shower.", "My portfolio is red, my eyes are too.", "Sleep is for those without leverage.", "I checked the chart 400 times today, nothing changed but my sanity.", "WAGMI is a lie we tell ourselves to keep holding.", "Diamond hands? More like heavy bags.", "I'm in it for the tech (I'm down 90%).", "Liquidation emails are my morning alarm.", "Just one more pump, I promise I'll exit.", "The devs did something... they sold."];
        const quotesElk = ["The antlers are heavy, but they are ours.", "We do not choose the burden, we only choose how to carry it.", "In the forest of the market, the Elk stands still.", "The herd survives not by speed, but by endurance.", "Shedding velvet is painful, but growth requires blood.", "The wilderness cares not for your wallet.", "We graze on the volatility of the world.", "To be an Elk is to carry the weight of the sky on your head.", "The clearing comes only after the thickest woods.", "Tracks in the snow fade, but the path remains."];

        let currentMode = 'existential';
        let currentQuote = -1;

        function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
            generateQuote();
        }

        function generateQuote() {
            const display = document.getElementById('quote-display');
            display.classList.remove('visible');
            setTimeout(() => {
                let pool = quotesExistential;
                if (currentMode === 'degen') pool = quotesDegen;
                else if (currentMode === 'elk') pool = quotesElk;
                let newQuote;
                do { newQuote = Math.floor(Math.random() * pool.length); } while (newQuote === currentQuote && pool.length > 1);
                currentQuote = newQuote;
                display.textContent = '"' + pool[currentQuote] + '"';
                display.classList.add('visible');
            }, 400);
        }

        function copyQuote() {
            copyToClipboard(document.getElementById('quote-display').innerText, 'WISDOM COPIED');
        }

        // --- PERSISTENT VOTING SYSTEM ---
        
        // Initial state from LocalStorage or 0
        let votes = JSON.parse(localStorage.getItem('elk_votes')) || { isolation: 0, anchoring: 0, distraction: 0, sublimation: 0 };
        // Check if user has voted
        let hasVoted = localStorage.getItem('elk_has_voted') === 'true';
        // Get which mechanism they voted for (to highlight it)
        let votedMech = localStorage.getItem('elk_voted_mech');

        // Function to update the UI based on current state
        function updateVoteUI() {
            for (const [mech, count] of Object.entries(votes)) {
                const card = document.querySelector(`[data-mechanism="${mech}"]`);
                if (card) {
                    card.querySelector('.vote-count').textContent = count.toLocaleString();
                }
            }
            
            // If already voted, disable all buttons and highlight the choice
            if (hasVoted) {
                document.querySelectorAll('.mechanism-card button').forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.textContent = "Voted";
                    btn.onclick = null; // Remove click handler
                });

                if (votedMech) {
                    const chosenCard = document.querySelector(`[data-mechanism="${votedMech}"]`);
                    if (chosenCard) chosenCard.classList.add('voted');
                }
            }
        }

        function vote(mech) {
            if (hasVoted) { showToast("ALREADY VOTED"); return; }
            
            // Update state
            votes[mech]++;
            hasVoted = true;
            votedMech = mech;
            
            // Save to LocalStorage
            localStorage.setItem('elk_votes', JSON.stringify(votes));
            localStorage.setItem('elk_has_voted', 'true');
            localStorage.setItem('elk_voted_mech', mech);
            
            // Update UI
            updateVoteUI();
            showToast("VOTE CAST");
        }

        // Initialize Voting UI on Load
        updateVoteUI();


        // Audio Player
        const tracks = [
            { title: "Before the Clearing", file: "Before the Clearing", desc: "The silence before revelation" },
            { title: "Crimson Twilight", file: "Crimson Twilight", desc: "Day bleeds into night" },
            { title: "Echoes Where Meaning Was", file: "Echoes Where Meaning Was", desc: "Hollow chambers" },
            { title: "Eternal Weight", file: "Eternal Weight", desc: "The paradox of being" },
            { title: "Forest Depths", file: "Forest Depths", desc: "Dissolution of self" },
            { title: "Herd Gathering", file: "Herd Gathering", desc: "Many antlers, one burden" },
            { title: "Herd Through the Valley", file: "Herd Through the Valley", desc: "Moving through the low points" },
            { title: "Migration of the Burdened", file: "Migration of the Burdened", desc: "Perpetual motion" },
            { title: "Mountain Echo", file: "Mountain Echo", desc: "Voices returning to us" },
            { title: "No Elk Walks Alone", file: "No Elk Walks Alone", desc: "Solitude in numbers" },
            { title: "Signal from the Ridge", file: "Signal from the Ridge", desc: "A call to ascend" },
            { title: "The Burden", file: "The Burden", desc: "We are our weight" },
            { title: "The Herd Remembers", file: "The Herd Remembers", desc: "History carved in bone" },
            { title: "The Weight of Knowing", file: "The Weight of Knowing", desc: "Awareness is heavy" },
            { title: "Turning Ash to Altar", file: "Turning Ash to Altar", desc: "Sacred remnants" },
            { title: "What Consciousness Costs", file: "What Consciousness Costs", desc: "The price of awakening" }
        ];

        let current = 0, playing = false, muted = false, shuffle = false, repeat = false;
        const audio = document.getElementById('audio-player');
        
        let audioContext, analyser, dataArray, source, isVisualizerInitialized = false;

        function initAudioContext() {
            if (isVisualizerInitialized) {
                if (audioContext && audioContext.state === 'suspended') audioContext.resume();
                return;
            }
            try {
                const AC = window.AudioContext || window.webkitAudioContext;
                if (!AC) return;
                audioContext = new AC();
                analyser = audioContext.createAnalyser();
                const isMobile = window.matchMedia('(pointer: coarse)').matches;
                analyser.fftSize = isMobile ? 128 : 256;
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                isVisualizerInitialized = true;
                drawVisualizer();
            } catch (e) { console.log('Audio init error:', e); }
        }

        let visualizerAnimationId;
        function drawVisualizer() {
            const canvas = document.getElementById('visualizer-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            const resize = () => {
                const rect = canvas.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
            };
            new ResizeObserver(resize).observe(canvas);
            resize();

            function animate() {
                visualizerAnimationId = requestAnimationFrame(animate);
                if (!playing || !analyser) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height); 
                    return;
                }
                analyser.getByteFrequencyData(dataArray);
                
                const dpr = window.devicePixelRatio || 1;
                const width = canvas.width / dpr;
                const height = canvas.height / dpr;

                ctx.clearRect(0, 0, width, height);
                
                const isMobile = window.matchMedia('(pointer: coarse)').matches;
                const bars = isMobile ? 30 : 50;
                const barWidth = width / bars;
                
                for (let i = 0; i < bars; i++) {
                    const idx = Math.floor(i * (dataArray.length / bars));
                    const barHeight = (dataArray[idx] / 255) * height * 0.5;
                    const x = i * barWidth;
                    const y = height - barHeight;
                    const gradient = ctx.createLinearGradient(0, y, 0, height);
                    gradient.addColorStop(0, 'rgba(139, 0, 0, 0.3)');
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 0.05)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(x, y, barWidth - 2, barHeight);
                }
            }
            animate();
        }

        function initPlaylist() {
            const pl = document.getElementById('playlist');
            pl.innerHTML = '';
            tracks.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = `track-item p-3 cursor-pointer flex items-center justify-between text-sm ${i === 0 ? 'active' : ''} rounded`;
                d.onclick = () => loadTrack(i, true, true);
                d.innerHTML = `<span class="text-white/40 truncate mr-2 font-mono text-xs">${t.title}</span><span class="text-[10px] text-white/20 shrink-0">${String(i+1).padStart(2,'0')}</span>`;
                pl.appendChild(d);
            });
            loadTrack(0, false, false);
        }

        function loadTrack(idx, auto = true, scroll = true) {
            current = idx;
            const t = tracks[idx];
            const base = 'https://raw.githubusercontent.com/exelkonsol/elk/main/';
            
            document.getElementById('track-title').textContent = t.title;
            document.getElementById('track-desc').textContent = '"' + t.desc + '"';
            
            const cb = '?v=' + Date.now();
            audio.src = `${base}${encodeURIComponent(t.file)}.mp3${cb}`;
            
            const artUrl = `${base}${encodeURIComponent(t.file)}.png`;
            document.getElementById('album-art-small').src = artUrl;
            document.getElementById('btn-art').src = artUrl;
            
            document.querySelectorAll('.track-item').forEach((e, i) => {
                e.classList.toggle('active', i === idx);
                if (i === idx && scroll) e.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
            
            document.getElementById('progress-fill').style.width = '0%';
            
            const loadHandler = () => {
                document.getElementById('time-total').textContent = fmt(audio.duration);
                if (auto) playAudio();
            };
            
            audio.removeEventListener('loadedmetadata', loadHandler);
            audio.addEventListener('loadedmetadata', loadHandler, { once: true });
            audio.load();
        }

        function togglePlay() {
            initAudioContext();
            if (audioContext && audioContext.state === 'suspended') audioContext.resume();
            playing ? pauseAudio() : playAudio();
        }

        function playAudio() {
            audio.play().then(() => {
                playing = true;
                document.getElementById('vinyl-disc').classList.add('playing');
                document.getElementById('mute-toggle-btn').classList.add('playing');
                document.getElementById('play-icon').setAttribute('data-lucide', 'pause');
                document.getElementById('track-status').textContent = "Playing";
                lucide.createIcons();
            }).catch(e => {
                console.log('Playback prevented', e);
                showToast("TAP TO PLAY");
            });
        }

        function pauseAudio() {
            audio.pause();
            playing = false;
            document.getElementById('vinyl-disc').classList.remove('playing');
            document.getElementById('mute-toggle-btn').classList.remove('playing');
            document.getElementById('play-icon').setAttribute('data-lucide', 'play');
            document.getElementById('track-status').textContent = "Paused";
            lucide.createIcons();
        }

        function toggleMute() {
            muted = !muted;
            audio.muted = muted;
            const icon = document.getElementById('mute-icon');
            if (muted) {
                icon.setAttribute('data-lucide', 'volume-x');
                document.getElementById('mute-toggle-btn').style.opacity = "0.7";
            } else {
                icon.setAttribute('data-lucide', 'volume-2');
                document.getElementById('mute-toggle-btn').style.opacity = "1";
            }
            lucide.createIcons();
        }

        function nextTrack() {
            if (shuffle) {
                let next;
                do { next = Math.floor(Math.random() * tracks.length); } while (next === current && tracks.length > 1);
                loadTrack(next, true, true);
            } else {
                loadTrack((current + 1) % tracks.length, true, true);
            }
        }

        function prevTrack() {
            if (audio.currentTime > 3) {
                audio.currentTime = 0;
            } else {
                loadTrack((current - 1 + tracks.length) % tracks.length, true, true);
            }
        }

        function toggleShuffle() {
            shuffle = !shuffle;
            const btn = document.getElementById('shuffle-btn');
            if (shuffle) {
                btn.classList.add('text-white/80'); btn.classList.remove('text-white/20');
            } else {
                btn.classList.remove('text-white/80'); btn.classList.add('text-white/20');
            }
            showToast(shuffle ? "SHUFFLE ON" : "SHUFFLE OFF");
        }

        function toggleRepeat() {
            repeat = !repeat;
            audio.loop = repeat;
            const btn = document.getElementById('repeat-btn');
            if (repeat) {
                btn.classList.add('text-white/80'); btn.classList.remove('text-white/20');
            } else {
                btn.classList.remove('text-white/80'); btn.classList.add('text-white/20');
            }
            showToast(repeat ? "REPEAT ON" : "REPEAT OFF");
        }

        let isDragging = false;
        const progressContainer = document.getElementById('progress-container');

        function updateProgress(clientX) {
            const rect = progressContainer.getBoundingClientRect();
            const pos = (clientX - rect.left) / rect.width;
            const clampedPos = Math.max(0, Math.min(1, pos));
            if (audio.duration) {
                audio.currentTime = clampedPos * audio.duration;
                document.getElementById('progress-fill').style.width = (clampedPos * 100) + '%';
            }
        }

        progressContainer.addEventListener('mousedown', (e) => { isDragging = true; updateProgress(e.clientX); }, { passive: true });
        document.addEventListener('mousemove', (e) => { if (isDragging) { e.preventDefault(); updateProgress(e.clientX); } });
        document.addEventListener('mouseup', () => { isDragging = false; });
        progressContainer.addEventListener('touchstart', (e) => { isDragging = true; updateProgress(e.touches[0].clientX); }, { passive: true });
        document.addEventListener('touchmove', (e) => { if (isDragging) { e.preventDefault(); updateProgress(e.touches[0].clientX); } }, { passive: false });
        document.addEventListener('touchend', () => { isDragging = false; }, { passive: true });

        function setVolume(v) {
            audio.volume = v / 100;
            if (v > 0 && muted) toggleMute();
        }

        function fmt(s) {
            if (isNaN(s) || !isFinite(s)) return '00:00';
            const m = Math.floor(s / 60), sec = Math.floor(s % 60);
            return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
        }

        let lastTimeUpdate = 0;
        audio.addEventListener('timeupdate', () => {
            if (!isDragging) {
                const now = Date.now();
                if (now - lastTimeUpdate < 200) return; 
                lastTimeUpdate = now;
                const p = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progress-fill').style.width = p + '%';
                document.getElementById('time-current').textContent = fmt(audio.currentTime);
            }
        });

        audio.addEventListener('ended', () => { if (!repeat) nextTrack(); });
        audio.addEventListener('pause', () => {
            if (playing && audio.currentTime !== audio.duration && !audio.ended) {
                playing = false;
                document.getElementById('vinyl-disc').classList.remove('playing');
                document.getElementById('mute-toggle-btn').classList.remove('playing');
                document.getElementById('play-icon').setAttribute('data-lucide', 'play');
                document.getElementById('track-status').textContent = "Paused";
                lucide.createIcons();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            switch(e.code) {
                case 'Space': e.preventDefault(); togglePlay(); break;
                case 'ArrowLeft': e.shiftKey ? prevTrack() : audio.currentTime -= 5; break;
                case 'ArrowRight': e.shiftKey ? nextTrack() : audio.currentTime += 5; break;
                case 'KeyM': toggleMute(); break;
            }
        });

        initPlaylist();

        window.addEventListener('beforeunload', () => {
            if (visualizerAnimationId) cancelAnimationFrame(visualizerAnimationId);
            if (audio) { audio.pause(); audio.src = ''; }
        });
    </script>
</body>
</html>
