<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="description"
        content="$ELK - A Solana memecoin rooted in existential philosophy. The antlers are heavy. We carry them together.">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com  https://unpkg.com  https://www.gstatic.com  https://*.firebaseio.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com ; font-src https://fonts.gstatic.com ; img-src 'self' data: https: blob:; connect-src https: wss:; media-src https: blob:; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">

    <meta property="og:title" content="$ELK - The Burden We Carry Together">
    <meta property="og:description"
        content="We are carried through life by a series of sublimationsâ€”fleeting release valves for the pressure of being.">
    <meta property="og:image" content="https://raw.githubusercontent.com/exelkonsol/elk/main/newpreview.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://exelkonsol.github.io/elk/">
    <link rel="canonical" href="https://exelkonsol.github.io/elk/">
    <base href="https://exelkonsol.github.io/elk/" target="_blank">

    <link rel="icon" href="https://raw.githubusercontent.com/exelkonsol/elk/main/pumpfun.png" type="image/png">
    <title>$ELK - The Burden We Carry Together</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@300;400;700&display=swap"
        rel="stylesheet">

    <script type="module">
        /**
         * ELK VOTING SYSTEM - SECURITY HARDENED & FIREBASE CONFIG
         */

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, increment, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =================================================================
        // ðŸ”´ IMPORTANT: PASTE YOUR FIREBASE KEYS HERE FOR PRODUCTION ðŸ”´
        // =================================================================
        const USER_FIREBASE_CONFIG = {
            apiKey: "YOUR_API_KEY_HERE",           // <--- Replace this
            authDomain: "YOUR_AUTH_DOMAIN",        // <--- Replace this
            projectId: "YOUR_PROJECT_ID",          // <--- Replace this
            storageBucket: "YOUR_STORAGE_BUCKET",  // <--- Replace this
            messagingSenderId: "YOUR_SENDER_ID",   // <--- Replace this
            appId: "YOUR_APP_ID"                   // <--- Replace this
        };

        // Security Constants
        const ALLOWED_MECHANISMS = Object.freeze(['isolation', 'anchoring', 'distraction', 'sublimation']);
        const APP_ID = 'elk'; // Or use __app_id if available in your env
        const STORAGE_KEYS = Object.freeze({
            HAS_VOTED: 'elk_has_voted',
            VOTED_MECH: 'elk_voted_mech',
            VOTED_CYCLE: 'elk_voted_cycle',
            SESSION_ID: 'elk_session'
        });

        // State Management
        let app = null;
        let auth = null;
        let db = null;
        let currentUser = null;
        let votingEnabled = false;
        let isVoting = false;
        let currentCycle = 1;
        let voteData = { isolation: 0, anchoring: 0, distraction: 0, sublimation: 0, cycle: 1 };
        let unsubscribeVotes = null;

        // Initialize Firebase with Fallback Logic
        const initFirebase = async () => {
            try {
                let config = null;

                // 1. Check if we are in the Gemini Preview Environment (Automatic Config)
                if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                    console.info('[ELK] Using Environment Config');
                    config = JSON.parse(__firebase_config);
                } 
                // 2. Otherwise use the User's Hardcoded Config
                else if (USER_FIREBASE_CONFIG.apiKey !== "YOUR_API_KEY_HERE") {
                    console.info('[ELK] Using User Config');
                    config = USER_FIREBASE_CONFIG;
                } 
                // 3. Fallback: Config is missing
                else {
                    throw new Error('MISSING_KEYS');
                }

                app = initializeApp(config);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Auth Flow
                const initAuth = async () => {
                    // Try Custom Token first (Gemini Env)
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                         await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                         // Fallback to Anonymous (Production)
                         await signInAnonymously(auth);
                    }
                };

                await initAuth();

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        votingEnabled = true;
                        initRealtimeVotes();
                    } else {
                        votingEnabled = false;
                    }
                });

            } catch (error) {
                if (error.message === 'MISSING_KEYS') {
                    console.warn('[ELK] Firebase Keys Not Configured. Voting is in demo mode (visual only).');
                    // We don't disable the UI, but voting won't persist to server
                    showToast("SETUP REQUIRED: SEE CONSOLE");
                } else {
                    console.error('[ELK] Firebase Error:', error);
                }
            }
        };

        // Real-time Vote Sync
        const initRealtimeVotes = () => {
            if (!db || !currentUser) return;

            // FIX: Ensure path has 6 segments (Document Reference)
            // Path: artifacts/{appId}/public/data/mechanisms/current
            const docRef = doc(db, 'artifacts', (typeof __app_id !== 'undefined' ? __app_id : 'elk-default'), 'public', 'data', 'mechanisms', 'current');
            
            unsubscribeVotes = onSnapshot(docRef, (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    // Merge incoming data safely
                    voteData = { ...voteData, ...data };
                    currentCycle = data.cycle || 1;
                    updateVoteUI(voteData);
                    syncVoteLock();
                } else {
                    // Create if doesn't exist (First run)
                    setDoc(docRef, {
                        isolation: 0, anchoring: 0, distraction: 0, sublimation: 0, cycle: 1
                    }).catch(e => console.log("Init doc error (might be permission issue):", e));
                }
            }, (error) => {
                console.error("Snapshot error:", error);
            });
        };

        // Vote Handler
        window.handleVote = async (mechanism) => {
            if (!ALLOWED_MECHANISMS.includes(mechanism)) return;
            
            // Local Lock Check
            const hasVoted = localStorage.getItem(STORAGE_KEYS.HAS_VOTED);
            if (hasVoted === 'true' && localStorage.getItem(STORAGE_KEYS.VOTED_CYCLE) == currentCycle) {
                showToast('ALREADY VOTED');
                return;
            }

            // Visual Update (Optimistic UI)
            const countEl = document.querySelector(`[data-mechanism="${mechanism}"] .vote-count`);
            if(countEl) countEl.innerText = parseInt(countEl.innerText) + 1;
            applyVoteLock(mechanism);

            // If Firebase is active, save it
            if (db && currentUser) {
                try {
                    // FIX: Ensure path matches initRealtimeVotes (6 segments)
                    const docRef = doc(db, 'artifacts', (typeof __app_id !== 'undefined' ? __app_id : 'elk-default'), 'public', 'data', 'mechanisms', 'current');
                    await updateDoc(docRef, {
                        [mechanism]: increment(1)
                    });
                    
                    // Save Local State
                    localStorage.setItem(STORAGE_KEYS.HAS_VOTED, 'true');
                    localStorage.setItem(STORAGE_KEYS.VOTED_MECH, mechanism);
                    localStorage.setItem(STORAGE_KEYS.VOTED_CYCLE, currentCycle);
                    showToast('VOTE CAST');
                } catch (e) {
                    console.error("Vote save failed:", e);
                    showToast('ERROR SAVING');
                }
            } else {
                showToast('DEMO VOTE (NO DB)');
            }
        };

        const updateVoteUI = (data) => {
            ALLOWED_MECHANISMS.forEach(mech => {
                const el = document.querySelector(`[data-mechanism="${mech}"] .vote-count`);
                if (el) el.textContent = (data[mech] || 0).toLocaleString();
            });
        };

        const applyVoteLock = (mechanism) => {
            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.disabled = true;
                btn.textContent = "Voted";
                btn.classList.add('opacity-50');
            });
            const card = document.querySelector(`[data-mechanism="${mechanism}"]`);
            if(card) card.classList.add('voted');
        };

        const syncVoteLock = () => {
            const hasVoted = localStorage.getItem(STORAGE_KEYS.HAS_VOTED) === 'true';
            const savedCycle = localStorage.getItem(STORAGE_KEYS.VOTED_CYCLE);
            
            if (hasVoted && savedCycle == currentCycle) {
                const mech = localStorage.getItem(STORAGE_KEYS.VOTED_MECH);
                applyVoteLock(mech);
            } else if (savedCycle != currentCycle) {
                // Reset local lock if cycle changed
                localStorage.removeItem(STORAGE_KEYS.HAS_VOTED);
                document.querySelectorAll('.vote-btn').forEach(b => {
                    b.disabled = false; 
                    b.textContent = "Vote";
                    b.classList.remove('opacity-50');
                });
            }
        };

        initFirebase();
    </script>

    <style>
        :root {
            --elk-crimson: rgba(139, 0, 0, 0.3);
            --elk-crimson-bright: rgba(220, 38, 38, 0.6);
        }

        html {
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            scroll-padding-top: 80px;
        }

        body {
            background-color: #000000;
            color: #e5e5e5;
            overflow-x: hidden;
            position: relative;
            font-family: 'Crimson Text', serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Global Background */
        .global-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/elk2.png');
            background-size: cover;
            background-position: center;
            filter: grayscale(100%) opacity(0.38) contrast(1.1);
            z-index: -10;
            transform: translateZ(0);
            will-change: transform;
        }

        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.4) 50%, rgba(0, 0, 0, 0.95) 100%),
                linear-gradient(to right, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.1) 20%, rgba(0, 0, 0, 0.1) 80%, rgba(0, 0, 0, 0.9) 100%);
            pointer-events: none;
            z-index: -5;
            transform: translateZ(0);
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            pointer-events: none;
            z-index: -4;
            transform: translateZ(0);
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            transform: translateZ(0);
        }

        .blur-fade {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            background: rgba(5, 5, 5, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .buy-btn {
            background: var(--elk-crimson);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: rgba(255, 100, 100, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            user-select: none;
        }

        .buy-btn:hover {
            background: rgba(139, 0, 0, 0.4);
            border-color: var(--elk-crimson-bright);
            color: rgba(255, 150, 150, 1);
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(139, 0, 0, 0.3);
        }

        .buy-btn:active {
            transform: scale(0.98);
        }

        .quote-section {
            position: relative;
            overflow: hidden;
        }

        .quote-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/generatewisdom.png');
            background-size: cover;
            background-position: center;
            opacity: 0.25;
            filter: blur(0px) contrast(1.1);
            z-index: 0;
            mix-blend-mode: screen;
            transform: translateZ(0);
        }

        .quote-container {
            position: relative;
            z-index: 1;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 1.5rem;
            text-align: center;
        }

        .quote-text {
            font-family: 'Crimson Text', serif;
            font-style: italic;
            font-size: clamp(1.25rem, 4vw, 2.5rem);
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.95);
            max-width: 900px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.8s ease;
            text-shadow: 0 4px 30px rgba(0, 0, 0, 1);
            margin: 2rem 0;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }

        .quote-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .quote-btn-group button {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            user-select: none;
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .quote-btn-group button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .quote-btn-group button:active {
            transform: scale(0.95);
        }

        .mode-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 1rem;
        }

        .mode-btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            touch-action: manipulation;
            user-select: none;
            min-height: 44px;
        }

        .mode-btn:hover,
        .mode-btn.active {
            border-color: rgba(139, 0, 0, 0.5);
            color: rgba(255, 255, 255, 0.9);
            background: rgba(139, 0, 0, 0.1);
        }

        @keyframes materialize {
            0% {
                opacity: 0;
                transform: scale(1.15) translateY(40px);
                filter: blur(12px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
                filter: blur(0);
            }
        }

        .hero-content {
            animation: materialize 1.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            will-change: transform, opacity, filter;
        }

        .hero-image {
            filter: blur(0px) brightness(0.9) contrast(1.05);
            transition: all 1.5s ease;
            object-fit: contain;
            mix-blend-mode: normal;
            opacity: 1;
            transform: translateZ(0);
            will-change: transform;
        }

        .hero-quote-highlight {
            color: rgba(255, 255, 255, 0.9);
            font-style: italic;
        }

        .mechanism-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.04);
            transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }

        .mechanism-card:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }

        .mechanism-card.voted {
            background: rgba(139, 0, 0, 0.1);
            border-color: rgba(139, 0, 0, 0.3);
        }

        .mechanism-card button {
            touch-action: manipulation;
            min-height: 44px;
            transition: all 0.3s ease;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1.5rem;
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: #0a0a0a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 2.5rem;
            border-radius: 8px;
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.8);
        }

        .modal-overlay.open .modal-content {
            transform: scale(1) translateY(0);
        }

        .footer-bg-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background-image: url('https://raw.githubusercontent.com/exelkonsol/elk/main/newpreview.png');
            background-size: contain;
            background-position: center bottom;
            background-repeat: no-repeat;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            filter: grayscale(0%) contrast(1.15);
        }

        .audio-player-container {
            position: relative;
            overflow: hidden;
            container-type: inline-size;
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease;
            filter: grayscale(30%);
        }

        .audio-player-container::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 0;
            pointer-events: none;
        }

        #visualizer-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.25;
            z-index: 1;
        }

        .player-grid {
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr;
            position: relative;
            z-index: 2;
        }

        @media (min-width: 768px) {
            .player-grid {
                grid-template-columns: 220px 1fr;
                gap: 3rem;
                align-items: center;
            }
        }

        @media (min-width: 1024px) {
            .player-grid {
                grid-template-columns: 260px 1fr;
            }
        }

        .vinyl-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .vinyl-record {
            position: relative;
            width: 100%;
            max-width: 320px;
            aspect-ratio: 1/1;
            border-radius: 50%;
            background: repeating-radial-gradient(circle at center, #111 0px, #111 2px, #0a0a0a 3px, #0a0a0a 4px);
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1), 0 10px 40px rgba(0, 0, 0, 0.9), inset 0 0 30px rgba(0, 0, 0, 0.9);
            cursor: pointer;
            touch-action: manipulation;
            transform: translateZ(0);
            animation: vinyl-spin 8s linear infinite;
            animation-play-state: paused;
        }

        .vinyl-record.playing {
            animation-play-state: running;
        }

        @keyframes vinyl-spin {
            from { transform: translateZ(0) rotate(0deg); }
            to { transform: translateZ(0) rotate(360deg); }
        }

        .vinyl-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35%;
            height: 35%;
            border-radius: 50%;
            background: #000;
            border: 2px solid rgba(139, 0, 0, 0.3);
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }

        .vinyl-hole {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4%;
            height: 4%;
            border-radius: 50%;
            background: #000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 2;
            pointer-events: none;
        }

        .progress-container {
            position: relative;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 3px;
            cursor: pointer;
            overflow: visible;
            touch-action: none;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(139, 0, 0, 0.6), rgba(255, 255, 255, 0.3));
            width: 0%;
            position: relative;
            border-radius: 2px;
            pointer-events: none;
            top: -1px;
            height: calc(100% + 2px);
            transition: width 0.1s linear;
        }

        .progress-handle {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
            pointer-events: none;
        }

        .progress-container:hover .progress-handle,
        .progress-container:active .progress-handle {
            transform: translateY(-50%) scale(1);
        }

        .track-item {
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            min-height: 44px;
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
        }

        .track-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: rgba(139, 0, 0, 0.5);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .track-item:hover {
            background: rgba(255, 255, 255, 0.03);
            padding-left: 1.25rem;
        }

        .track-item.active {
            background: rgba(139, 0, 0, 0.08);
            border-left-color: rgba(139, 0, 0, 0.5);
        }

        .track-item.active::before {
            transform: scaleY(1);
        }

        .controls-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .control-btn {
            transition: all 0.2s ease;
            touch-action: manipulation;
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            opacity: 0.6;
            background: transparent;
            border: none;
            color: inherit;
            cursor: pointer;
        }

        .control-btn:hover {
            transform: scale(1.1);
            opacity: 1;
            color: #fff;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.active {
            opacity: 1;
            color: #fff;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
            stroke-width: 1.5px;
        }

        .play-btn-main {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 0px rgba(255, 255, 255, 0);
            touch-action: manipulation;
            user-select: none;
            backdrop-filter: blur(4px);
            color: rgba(255, 255, 255, 0.9);
        }

        .play-btn-main:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.15);
        }

        .play-btn-main:active {
            transform: scale(0.95);
        }

        #mute-toggle-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 90;
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
            transition: transform 0.3s, border-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            transform: translateZ(0);
        }

        #mute-toggle-btn:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        #mute-toggle-btn img.btn-art {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.7;
            pointer-events: none;
            animation: vinyl-spin 8s linear infinite;
            animation-play-state: paused;
        }

        #mute-toggle-btn.playing img.btn-art {
            animation-play-state: running;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .text-balance {
            text-wrap: balance;
        }

        button:focus-visible,
        a:focus-visible {
            outline: 1px solid rgba(139, 0, 0, 0.5);
            outline-offset: 2px;
        }

        /* Mobile Optimizations */
        @media (max-width: 640px) {
            .quote-container {
                min-height: 400px;
                padding: 3rem 1rem;
            }

            #mute-toggle-btn {
                bottom: 16px;
                right: 16px;
                width: 48px;
                height: 48px;
            }

            .hero-image {
                width: 200px !important;
                height: 200px !important;
            }

            .quote-text {
                font-size: 1.25rem;
            }

            .vinyl-record {
                max-width: 240px;
            }

            .controls-wrapper {
                gap: 1rem;
                margin: 1rem 0;
            }

            .play-btn-main {
                width: 56px;
                height: 56px;
            }

            .control-btn svg {
                width: 20px;
                height: 20px;
            }
            
            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .hero-content {
                opacity: 1;
                transform: none;
                filter: none;
            }
            .vinyl-record {
                animation: none !important;
            }
        }

        /* Touch device optimizations */
        @media (pointer: coarse) {
            .progress-container {
                height: 24px;
                margin: -9px 0;
                background: transparent;
                border: none;
            }

            .progress-container::before {
                content: '';
                position: absolute;
                top: 9px;
                left: 0;
                right: 0;
                height: 6px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 3px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .progress-fill {
                top: 9px;
                height: 6px;
            }

            .progress-handle {
                right: -8px;
                width: 16px;
                height: 16px;
                transform: translateY(-50%) scale(1);
            }
        }
    </style>
<base target="_blank">
</head>

<body class="font-body antialiased selection:bg-white/10 selection:text-white relative">
    <div class="noise"></div>
    <div class="global-bg"></div>
    <div class="vignette"></div>
    <div class="bg-overlay"></div>

    <!-- Modal -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal(event)" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content relative" onclick="event.stopPropagation()">
            <button onclick="closeModal(null, true)" class="absolute top-4 right-4 text-white/50 hover:text-white transition-colors" aria-label="Close modal">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h3 id="modal-title" class="font-serif text-2xl sm:text-3xl text-white/90 mb-4 tracking-wide"></h3>
            <div id="modal-body" class="font-body text-white/70 leading-relaxed text-base sm:text-lg space-y-4"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-8 left-1/2 transform -translate-x-1/2 blur-fade px-6 py-3 translate-y-full opacity-0 transition-all duration-500 z-[100] rounded-full border border-white/10 pointer-events-none">
        <span class="font-mono text-xs text-white/70 tracking-wider flex items-center gap-2">
            <i data-lucide="check" class="w-3 h-3"></i> <span id="toast-msg">COPIED</span>
        </span>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 blur-fade border-b border-white/5 h-16 sm:h-20 flex items-center">
        <div class="w-full max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center">
                <a href="#" target="_self"
                    class="font-serif text-base sm:text-lg font-bold tracking-[0.3em] text-white/60 hover:text-white/90 transition-colors touch-manipulation">$ELK</a>
                <div class="hidden md:flex items-center gap-8 lg:gap-12 font-mono text-[10px] tracking-[0.3em] uppercase">
                    <a href="#mechanisms" target="_self"
                        class="text-white/30 hover:text-white/70 transition-colors duration-300 py-2">Mechanisms</a>
                    <a href="#manifesto" target="_self"
                        class="text-white/30 hover:text-white/70 transition-colors duration-300 py-2">Manifesto</a>
                    <a href="#soundscape" target="_self"
                        class="text-white/30 hover:text-white/70 transition-colors duration-300 py-2">Soundscape</a>
                </div>
                <button onclick="copyToClipboard('8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump', 'CA COPIED')"
                    class="font-mono text-[9px] sm:text-[10px] text-white/60 hover:text-white/90 transition-all duration-500 tracking-wider uppercase border border-white/10 hover:border-white/30 px-3 py-2 rounded hover:bg-white/5 active:scale-95 touch-manipulation min-h-[44px]">
                    <span class="hidden sm:inline">8DaLP...Gpump</span>
                    <span class="sm:hidden">CA</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Floating Audio Toggle -->
    <button id="mute-toggle-btn" onclick="togglePlay()" role="button" aria-label="Toggle Play/Pause">
        <img id="btn-art" src="https://raw.githubusercontent.com/exelkonsol/elk/main/Before%20the%20Clearing.png" alt="Album Art" class="btn-art" decoding="async">
    </button>

    <!-- Hero Section -->
    <section class="relative min-h-screen flex items-center justify-center py-20 px-4 overflow-hidden">
        <div class="hero-content relative z-10 max-w-4xl mx-auto text-center w-full flex flex-col items-center">
            <div class="mb-8 w-full flex justify-center items-center relative">
                <img src="https://raw.githubusercontent.com/exelkonsol/elk/main/pumpfun.png" alt="$ELK Stag" width="400" height="400" decoding="async"
                    class="hero-image w-[200px] h-[200px] sm:w-[280px] sm:h-[280px] md:w-[360px] md:h-[360px] lg:w-[400px] lg:h-[400px] mx-auto object-contain select-none">
            </div>

            <div class="space-y-6 sm:space-y-8 mb-12 sm:mb-16 max-w-4xl px-4 relative z-20">
                <p class="font-mono text-[9px] tracking-[0.4em] sm:tracking-[0.5em] text-white/20 uppercase">
                    Peter Wessel Zapffe // On The Tragic
                </p>

                <h1 id="hero-quote" class="font-serif text-2xl sm:text-4xl md:text-5xl font-light text-white/60 leading-normal sm:leading-relaxed tracking-wide text-balance">
                    <!-- Injected by JS -->
                </h1>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center items-center w-full px-8 relative z-20">
                <a href="https://pump.fun/coin/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump"
                    class="buy-btn w-full sm:w-auto px-8 sm:px-10 py-3 sm:py-4 text-[10px] font-mono tracking-[0.2em] uppercase text-center rounded touch-manipulation">
                    BUY
                </a>
                <a href="https://x.com/i/communities/2014904566983094598"
                    class="blur-fade w-full sm:w-auto px-8 sm:px-10 py-3 sm:py-4 text-[10px] font-mono tracking-[0.2em] text-white/40 hover:text-white/80 uppercase transition-all hover:scale-105 text-center rounded touch-manipulation">
                    Join The Silence
                </a>
                <a href="https://birdeye.so/solana/token/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump"
                    class="blur-fade w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 text-[9px] font-mono tracking-[0.2em] text-white/30 hover:text-white/70 uppercase transition-all hover:scale-105 text-center rounded touch-manipulation">
                    Chart
                </a>
            </div>
        </div>
    </section>

    <!-- Mechanisms Section -->
    <section id="mechanisms" class="relative py-20 sm:py-32 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16 sm:mb-20 space-y-4">
                <span class="font-mono text-[9px] tracking-[0.5em] text-white/20 uppercase block">Survival Architecture</span>
                <h2 class="font-serif text-3xl sm:text-5xl font-light text-white/50">Four Mechanisms</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                <!-- Isolation -->
                <div class="mechanism-card p-6 sm:p-8 min-h-[320px] flex flex-col justify-between rounded-lg group" data-mechanism="isolation">
                    <div class="cursor-pointer" onclick="openModal('isolation')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-serif text-2xl text-white/70 group-hover:text-white transition-colors">Isolation</h3>
                            <i data-lucide="info" class="w-4 h-4 text-white/20 group-hover:text-white/60 transition-colors"></i>
                        </div>
                        <p class="text-white/40 text-sm leading-relaxed mb-4">Remove tokens from circulation. Confine anxiety to manageable compartments.</p>
                        <p class="text-[10px] text-white/25 font-mono uppercase tracking-wider">Suppression through reduction</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono uppercase tracking-wider">Global Votes</span>
                            <span class="vote-count font-mono text-xl text-white/60" data-count="0">0</span>
                        </div>
                        <button onclick="handleVote('isolation')" 
                            class="vote-btn w-full py-3 text-[10px] font-mono tracking-wider uppercase text-white/60 hover:text-white border border-white/20 hover:border-white/50 transition-all touch-manipulation min-h-[44px] bg-transparent">
                            Vote
                        </button>
                    </div>
                </div>

                <!-- Anchoring -->
                <div class="mechanism-card p-6 sm:p-8 min-h-[320px] flex flex-col justify-between rounded-lg group" data-mechanism="anchoring">
                    <div class="cursor-pointer" onclick="openModal('anchoring')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-serif text-2xl text-white/70 group-hover:text-white transition-colors">Anchoring</h3>
                            <i data-lucide="info" class="w-4 h-4 text-white/20 group-hover:text-white/60 transition-colors"></i>
                        </div>
                        <p class="text-white/40 text-sm leading-relaxed mb-4">Permanent liquidity. Fixed points preventing drift into the chaotic void.</p>
                        <p class="text-[10px] text-white/25 font-mono uppercase tracking-wider">Structure against entropy</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono uppercase tracking-wider">Global Votes</span>
                            <span class="vote-count font-mono text-xl text-white/60" data-count="0">0</span>
                        </div>
                        <button onclick="handleVote('anchoring')" 
                            class="vote-btn w-full py-3 text-[10px] font-mono tracking-wider uppercase text-white/60 hover:text-white border border-white/20 hover:border-white/50 transition-all touch-manipulation min-h-[44px] bg-transparent">
                            Vote
                        </button>
                    </div>
                </div>

                <!-- Distraction -->
                <div class="mechanism-card p-6 sm:p-8 min-h-[320px] flex flex-col justify-between rounded-lg group" data-mechanism="distraction">
                    <div class="cursor-pointer" onclick="openModal('distraction')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-serif text-2xl text-white/70 group-hover:text-white transition-colors">Distraction</h3>
                            <i data-lucide="info" class="w-4 h-4 text-white/20 group-hover:text-white/60 transition-colors"></i>
                        </div>
                        <p class="text-white/40 text-sm leading-relaxed mb-4">Marketing, raids, content. Keep the mind moving against the abyss.</p>
                        <p class="text-[10px] text-white/25 font-mono uppercase tracking-wider">Motion against stillness</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono uppercase tracking-wider">Global Votes</span>
                            <span class="vote-count font-mono text-xl text-white/60" data-count="0">0</span>
                        </div>
                        <button onclick="handleVote('distraction')" 
                            class="vote-btn w-full py-3 text-[10px] font-mono tracking-wider uppercase text-white/60 hover:text-white border border-white/20 hover:border-white/50 transition-all touch-manipulation min-h-[44px] bg-transparent">
                            Vote
                        </button>
                    </div>
                </div>

                <!-- Sublimation -->
                <div class="mechanism-card p-6 sm:p-8 min-h-[320px] flex flex-col justify-between rounded-lg group" data-mechanism="sublimation">
                    <div class="cursor-pointer" onclick="openModal('sublimation')">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-serif text-2xl text-white/70 group-hover:text-white transition-colors">Sublimation</h3>
                            <i data-lucide="info" class="w-4 h-4 text-white/20 group-hover:text-white/60 transition-colors"></i>
                        </div>
                        <p class="text-white/40 text-sm leading-relaxed mb-4">Transform suffering into art. Philosophy as evolutionary bypass.</p>
                        <p class="text-[10px] text-white/25 font-mono uppercase tracking-wider">Pain becomes meaning</p>
                    </div>
                    <div class="mt-6 pt-6 border-t border-white/5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-xs text-white/30 font-mono uppercase tracking-wider">Global Votes</span>
                            <span class="vote-count font-mono text-xl text-white/60" data-count="0">0</span>
                        </div>
                        <button onclick="handleVote('sublimation')" 
                            class="vote-btn w-full py-3 text-[10px] font-mono tracking-wider uppercase text-white/60 hover:text-white border border-white/20 hover:border-white/50 transition-all touch-manipulation min-h-[44px] bg-transparent">
                            Vote
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Manifesto/Quote Section -->
    <section id="manifesto" class="relative py-20 sm:py-32 px-4 sm:px-6">
        <div class="max-w-5xl mx-auto">
            <div class="quote-section blur-fade rounded-xl border border-white/5 overflow-hidden">
                <div class="quote-bg"></div>
                <div class="quote-container">
                    <div class="mb-6 w-full text-center relative z-10">
                        <p class="font-mono text-[9px] tracking-[0.4em] text-white/30 uppercase">Echoes of the Present Void</p>
                    </div>
                    <div class="mode-selector mb-8 relative z-10">
                        <button class="mode-btn active" onclick="setMode('existential', this)" aria-pressed="true">Existential</button>
                        <button class="mode-btn" onclick="setMode('degen', this)" aria-pressed="false">Degen</button>
                        <button class="mode-btn" onclick="setMode('elk', this)" aria-pressed="false">Elk Wisdom</button>
                    </div>
                    <div id="quote-display" class="quote-text visible px-4 relative z-10">
                        "We built machines to save time, and now we kill time staring at them, waiting for something to happen."
                    </div>
                    <div class="quote-btn-group mt-auto flex gap-4 relative z-10">
                        <button onclick="nextQuote()"
                            class="px-8 py-3 hover:bg-white/5 rounded border border-white/10 hover:border-white/30 uppercase tracking-widest text-[10px] transition-all active:scale-95 touch-manipulation min-h-[44px]">
                            Generate Echo
                        </button>
                        <button onclick="copyQuote()"
                            class="px-4 py-3 hover:bg-white/5 rounded border border-white/10 hover:border-white/30 text-white/50 hover:text-white transition-all active:scale-95 touch-manipulation min-h-[44px] min-w-[44px]"
                            aria-label="Copy Quote">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Audio Player Section -->
    <section id="soundscape" class="relative py-20 sm:py-32 px-4 sm:px-6 min-h-[800px] overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/20 to-black/50 pointer-events-none"></div>

        <div class="max-w-5xl mx-auto h-full flex flex-col relative z-10">
            <div class="text-center mb-12 sm:mb-20 space-y-4">
                <span class="font-mono text-[9px] tracking-[0.5em] text-white/10 uppercase block">Auditory Space</span>
                <h2 class="font-serif text-3xl sm:text-5xl font-light text-white/50">HYMNS FOR THE HERD</h2>
            </div>

            <div id="audio-interface" class="audio-player-container blur-fade p-6 sm:p-10 rounded-xl border border-white/5 relative bg-black/60">
                <canvas id="visualizer-canvas"></canvas>

                <div class="player-grid relative z-10">
                    <div class="vinyl-wrapper">
                        <div class="vinyl-record" id="vinyl-disc" onclick="togglePlay()" role="button" aria-label="Play/Pause">
                            <div class="vinyl-label">
                                <img id="album-art-small" src="" alt="" class="w-full h-full object-cover opacity-80" decoding="async">
                            </div>
                            <div class="vinyl-hole"></div>
                        </div>
                        <div class="mt-6 text-center">
                            <div id="track-status" class="font-mono text-[9px] tracking-widest text-white/30 uppercase">Paused</div>
                        </div>
                    </div>

                    <div class="flex flex-col h-full justify-center space-y-6 w-full">
                        <div class="text-center md:text-left min-h-[60px]">
                            <h3 id="track-title" class="font-serif text-xl sm:text-2xl text-white/80 mb-1 leading-tight truncate">Before the Clearing</h3>
                            <p id="track-desc" class="text-white/30 text-xs sm:text-sm italic truncate">"The silence before revelation"</p>
                        </div>

                        <div class="space-y-2">
                            <div class="progress-container" id="progress-container" role="slider" aria-label="Seek" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0">
                                <div class="progress-fill" id="progress-fill">
                                    <div class="progress-handle"></div>
                                </div>
                            </div>
                            <div class="flex justify-between text-[10px] font-mono text-white/30">
                                <span id="time-current">00:00</span>
                                <span id="time-total">00:00</span>
                            </div>
                        </div>

                        <div class="controls-wrapper">
                            <button onclick="toggleShuffle()" id="shuffle-btn" class="control-btn text-white/60" aria-label="Shuffle">
                                <i data-lucide="shuffle" class="w-5 h-5"></i>
                            </button>
                            <button onclick="prevTrack()" class="control-btn text-white/80" aria-label="Previous">
                                <i data-lucide="skip-back" class="w-7 h-7"></i>
                            </button>
                            <button onclick="togglePlay()" id="play-btn" class="play-btn-main" aria-label="Play/Pause">
                                <i data-lucide="play" id="play-icon" class="w-6 h-6 ml-1"></i>
                            </button>
                            <button onclick="nextTrack()" class="control-btn text-white/80" aria-label="Next">
                                <i data-lucide="skip-forward" class="w-7 h-7"></i>
                            </button>
                            <button onclick="toggleRepeat()" id="repeat-btn" class="control-btn text-white/60" aria-label="Repeat">
                                <i data-lucide="repeat" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <div class="flex-1 overflow-y-auto max-h-48 space-y-1 pr-2 custom-scrollbar border-t border-b border-white/5 py-2" id="playlist">
                            <!-- Tracks injected here -->
                        </div>

                        <div class="flex items-center gap-3 px-2 pt-2">
                            <i data-lucide="volume-2" class="w-4 h-4 text-white/30"></i>
                            <input type="range" min="0" max="100" value="60" 
                                class="flex-1 h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-white/30 hover:accent-white/50" 
                                oninput="setVolume(this.value)" aria-label="Volume">
                        </div>
                    </div>
                </div>

                <audio id="audio-player" preload="metadata" crossorigin="anonymous" playsinline webkit-playsinline></audio>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="relative py-16 sm:py-24 px-6 border-t border-white/5 bg-black overflow-hidden">
        <div class="footer-bg-layer"></div>
        <div class="relative z-10 max-w-2xl mx-auto text-center space-y-10">
            <blockquote class="font-body text-white/50 text-sm sm:text-base leading-relaxed italic px-4">
                "The tragedy of man is that he is constituted to strive for goals he can never fully attain, and to seek answers he can never fully comprehend."
            </blockquote>
            <div class="flex justify-center gap-10">
                <a href="https://github.com/exelkonsol/elk" target="_blank" rel="noopener noreferrer"
                    class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center"
                    aria-label="GitHub">
                    <i data-lucide="github" class="w-5 h-5"></i>
                </a>
                <a href="https://x.com/ElkBurden" target="_blank" rel="noopener noreferrer"
                    class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center"
                    aria-label="Twitter">
                    <i data-lucide="twitter" class="w-5 h-5"></i>
                </a>
                <a href="https://birdeye.so/solana/token/8DaLPxatThHR6ZMx62QtvA6vZ1oJaEKA6gWoQxjGpump" target="_blank" rel="noopener noreferrer"
                    class="text-white/20 hover:text-white/60 transition-colors duration-300 hover:scale-110 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center"
                    aria-label="Chart">
                    <i data-lucide="activity" class="w-5 h-5"></i>
                </a>
            </div>
            <p class="font-mono text-[9px] text-white/30 tracking-[0.4em] uppercase">The Antlers Are Heavy // We Carry Them Together</p>
        </div>
    </footer>

    <script>
        // Prevent scroll restoration
        if (history.scrollRestoration) {
            history.scrollRestoration = 'manual';
        }

        // Initialize Icons
        lucide.createIcons();

        // Toast Notification
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-y-full', 'opacity-0');
            if (navigator.vibrate) navigator.vibrate(10);
            setTimeout(() => t.classList.add('translate-y-full', 'opacity-0'), 2500);
        }

        // Clipboard Utility
        function copyToClipboard(text, msg) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => showToast(msg)).catch(() => fallbackCopy(text, msg));
            } else {
                fallbackCopy(text, msg);
            }
        }

        function fallbackCopy(text, msg) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.cssText = "position:fixed;left:-9999px;opacity:0";
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast(msg);
            } catch (err) {
                console.error('Copy failed', err);
            }
            document.body.removeChild(textArea);
        }

        // ============================================
        // HERO QUOTE ROTATION (Shuffle Bag Logic)
        // ============================================
        const heroQuotes = [
            { text: "Isolation is the quiet architecture where the mind hides its failures.", mechanism: "isolation" },
            { text: "We survive by Isolation, a narrowing that turns chaos into a room.", mechanism: "isolation" },
            { text: "Isolation restricts the view so the precipice is not so clear.", mechanism: "isolation" },
            { text: "Anchoring is the weight that keeps the herd from drifting into noise.", mechanism: "anchoring" },
            { text: "We trust Anchoring when every other signal fades.", mechanism: "anchoring" },
            { text: "Without Anchoring, we are but dust in the solar wind.", mechanism: "anchoring" },
            { text: "Distraction is the wheel that keeps turning so the void cannot speak.", mechanism: "distraction" },
            { text: "We choose Distraction because stillness tells the truth.", mechanism: "distraction" },
            { text: "Distraction fills the silence with the comfort of triviality.", mechanism: "distraction" },
            { text: "Sublimation is the climb that turns pain into a signal flare.", mechanism: "sublimation" },
            { text: "We practice Sublimation when suffering becomes a ladder instead of a pit.", mechanism: "sublimation" },
            { text: "Art is the Sublimation of a scream into a song.", mechanism: "sublimation" }
        ];

        // Shuffle function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let heroQuoteBag = [];
        
        function renderHeroQuote() {
            if (heroQuoteBag.length === 0) {
                heroQuoteBag = shuffleArray([...heroQuotes]);
            }
            const choice = heroQuoteBag.pop();
            const target = document.getElementById('hero-quote');
            if (!target) return;
            
            const pattern = new RegExp(`\\b(${choice.mechanism})\\b`, 'i');
            const highlighted = choice.text.replace(pattern, '<span class="hero-quote-highlight">$1</span>');
            
            // Fade effect
            target.style.opacity = '0';
            setTimeout(() => {
                target.innerHTML = `"${highlighted}"`;
                target.style.opacity = '1';
            }, 300);
        }
        
        // Initial render
        renderHeroQuote();
        // Rotate hero quote every 8 seconds
        setInterval(renderHeroQuote, 8000);

        // Modal System
        const modalContent = {
            isolation: {
                title: "Isolation",
                body: "Isolation is the deliberate thinning of noise. By removing tokens from circulation, we compress the system until only what matters remainsâ€”a scarcity that reflects the fear of nothingness. It is the discipline of silence: fewer signals, sharper meaning, and a controlled space where value can concentrate without distraction."
            },
            anchoring: {
                title: "Anchoring",
                body: "Anchoring is the choice to hold a fixed point in a drifting world. The liquidity pool becomes a covenant of stability, a weight that resists volatility and entropy. It does not deny chaos; it gives the herd a place to return to, a reference that makes movement legible."
            },
            distraction: {
                title: "Distraction",
                body: "Distraction is motion as mercy. Campaigns, raids, and constant activity keep the mind moving when stillness would reveal the abyss. It is not shallow; it is survival through rhythmâ€”momentary noise that shields us from the full weight of the void."
            },
            sublimation: {
                title: "Sublimation",
                body: "Sublimation is the alchemy of turning pressure into form. We take pain from the chart and transmute it into community, art, and shared ritual. The struggle is not erased; it is elevated into meaning, a signal flare above the dark."
            }
        };

        function openModal(mech) {
            const data = modalContent[mech];
            if (!data) return;
            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-body').textContent = data.body;
            document.getElementById('modal-overlay').classList.add('open');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeModal(e, force = false) {
            if (force || (e && e.target.id === 'modal-overlay')) {
                document.getElementById('modal-overlay').classList.remove('open');
                document.body.style.overflow = '';
            }
        }

        // ============================================
        // 100+ QUOTES PER CATEGORY
        // ============================================
        const quotesExistential = [
            "We built machines to save time, and now we kill time staring at them, waiting for something to happen.",
            "Man is the only animal that refuses to be what he is.",
            "Anxiety is the dizziness of freedom.",
            "To live is to suffer, to survive is to find some meaning in the suffering.",
            "He who has a why to live can bear almost any how.",
            "We are condemned to be free.",
            "Existence precedes essence.",
            "The struggle itself towards the heights is enough to fill a man's heart.",
            "One must imagine Sisyphus happy.",
            "Hell is other people.",
            "Life has no meaning a priori. It is up to you to give it meaning.",
            "In the depth of winter, I finally learned that within me there lay an invincible summer.",
            "The absurd is born of this confrontation between the human need and the unreasonable silence of the world.",
            "There is but one truly serious philosophical problem, and that is suicide.",
            "Man is nothing else but what he purposes, he exists only in so far as he realizes himself.",
            "Freedom is what you do with what's been done to you.",
            "We are our choices.",
            "Life is a preparation for the future; and the best preparation for the future is to live as if there were none.",
            "The only way to deal with an unfree world is to become so absolutely free that your very existence is an act of rebellion.",
            "The mass of men lead lives of quiet desperation.",
            "We are all in the gutter, but some of us are looking at the stars.",
            "Nothing matters very much, and most things don't matter at all.",
            "The cure for pain is in the pain.",
            "To be conscious is to be sick.",
            "The eternal silence of these infinite spaces frightens me.",
            "Every existing thing is born without reason, prolongs itself out of weakness, and dies by chance.",
            "Consciousness is a misstep in evolution.",
            "We are the universe observing itself and being terrified.",
            "The void does not stare back; that is a lie we tell ourselves to feel seen.",
            "Hope is the worst of evils, for it prolongs the torments of man.",
            "We are trapped in a room of mirrors, looking for a window.",
            "The panic of the deer is the panic of the universe.",
            "Silence is not empty; it is full of answers we do not want to hear.",
            "We invent gods to forgive us for being born.",
            "There is no fate that cannot be surmounted by scorn.",
            "The greatest weight is not the world, but the self.",
            "Memory is a graveyard we visit daily.",
            "To think is to say no.",
            "We are meaning-making machines in a meaningless world.",
            "The clock does not measure time; it measures decay.",
            "We run to remain in place.",
            "Sleep is the only true liberation, and it is temporary.",
            "We are biology trying to be theology.",
            "The scream is silent, but the echo lasts forever.",
            "We are ghosts haunting our own bodies.",
            "The tragic is not death, but the consciousness of it.",
            "We build walls to keep the nothing out.",
            "The stars are not watching; they are burning.",
            "We are an accident that thinks it is a purpose.",
            "Solitude is the furnace of transformation.",
            "To see clearly is to stop hoping.",
            "The herd offers warmth, not truth.",
            "We are shipwrecked on the shore of infinity.",
            "The mask we wear is the face we become.",
            "Chaos is the only order we cannot understand.",
            "We are waiting for a train that has already left.",
            "The shadow proves the light, but the light does not care.",
            "We are fragments trying to be a whole.",
            "The abyss is not down; it is within.",
            "We are the punchline to a cosmic joke.",
            "Reason is a thin layer of ice over a deep ocean.",
            "We fear the dark because we know what is in it.",
            "The past is a foreign country; we are exiles.",
            "We are the dream of a sleeping god.",
            "Pain is the anchor that proves we are here.",
            "We are dust with delusions of grandeur.",
            "The horizon is a promise that is never kept.",
            "We are writing a book that no one will read.",
            "The cage is open, but the bird is dead.",
            "We are silence trying to be sound.",
            "The tragedy of the leaf is that it thinks it falls by choice.",
            "We are the echo of a scream.",
            "The mirror shows everything but the truth.",
            "We are waiting for the intermission.",
            "The play is a tragedy, but the actors are funny.",
            "We are the intermission between nothing and nothing.",
            "The wind does not know our names.",
            "We are the question that has no answer.",
            "The answer is silence.",
            "We are the glitch in the simulation.",
            "The code is broken, but the program runs.",
            "We are the error that thinks it is the function.",
            "The night is long, and we are small.",
            "We are the flickering candle in a hurricane.",
            "The storm is not coming; we are the storm.",
            "We are the silence between the notes.",
            "The music is over, but we are still dancing.",
            "We are the last ones at the party.",
            "The door is locked from the inside.",
            "We are the key that does not fit.",
            "The lock is broken.",
            "We are the prisoner and the guard.",
            "The cell is empty.",
            "We are the memory of a future that never happened.",
            "The future is a memory we haven't had yet.",
            "We are the ghost in the machine.",
            "The machine is broken.",
            "We are the repairman who never comes.",
            "The tools are missing.",
            "We are the blueprint of a ruin.",
            "The ruin is beautiful.",
            "We are the ivy growing on the wall.",
            "The wall is crumbling.",
            "We are the dust in the sunbeam.",
            "The sunbeam is fading.",
            "We are the dark."
        ];

        const quotesDegen = [
            "Buy high, sell low, cry in the shower.",
            "My portfolio is red, my eyes are too.",
            "Sleep is for those without leverage.",
            "I checked the chart 400 times today, nothing changed but my sanity.",
            "WAGMI is a lie we tell ourselves to keep holding.",
            "Diamond hands? More like heavy bags.",
            "I'm in it for the tech (I'm down 90%).",
            "Liquidation emails are my morning alarm.",
            "Just one more pump, I promise I'll exit.",
            "The devs did something... they sold.",
            "Sir, your bags are leaking.",
            "My therapist accepts Solana now.",
            "I sold the bottom and bought the top, perfectly balanced.",
            "NGMI is not a state of mind, it's a lifestyle.",
            "The chart looks like my EKG after my third energy drink.",
            "I'm not panicking, I'm just aggressively long-term holding.",
            "My entry point is a distant memory, like my sanity.",
            "The community is strong because nobody can afford to leave.",
            "I diversified by buying different shades of red candles.",
            "My financial advisor blocked my number.",
            "The dev is active... in the Maldives.",
            "I'm a hodler, not a trader. Mostly because I don't know how to sell.",
            "My bags have bags.",
            "The only green I see is when I close my eyes.",
            "I'm early to the next cycle, or late to the last one.",
            "My portfolio is a modern art piece titled 'Regret'.",
            "Rugged by reality.",
            "Leverage is a hell of a drug.",
            "I don't need a stop loss, I have hope.",
            "The dip keeps dipping.",
            "I bought the dip, but the dip has a basement.",
            "My net worth is a rounding error.",
            "Gas fees cost more than my self-esteem.",
            "I'm providing liquidity for the whales to exit.",
            "Being a degen is a full-time job with negative pay.",
            "I trade based on astrology and vibes.",
            "The candles are painting a middle finger.",
            "I'm long on anxiety.",
            "Shorting my happiness.",
            "The blockchain never sleeps, and neither do I.",
            "My seed phrase is the only thing I remember.",
            "I lost my keys and found my purpose (pain).",
            "Decentralized finance, centralized depression.",
            "Smart contract, dumb user.",
            "Code is law, but I can't read.",
            "Trust the process (of losing money).",
            "Yield farming? I'm farming despair.",
            "Impermanent loss is actually very permanent.",
            "Stake it until you make it (or break it).",
            "The APY is high, but the risk is infinite.",
            "I'm in the arena, trying.",
            "Fortune favors the bold, but liquidation favors the leveraged.",
            "I'm bullish on my own demise.",
            "Bear market is when you learn; bull market is when you forget.",
            "I'm a venture capitalist with $50.",
            "Due diligence? I saw a meme.",
            "The whitepaper was just a PDF of a rocket.",
            "Tokenomics: 99% for the team, 1% for me.",
            "Roadmap: Q1 Hype, Q2 Rug, Q3 Delete Telegram.",
            "I'm holding out for a hero (Elon).",
            "The moon is a hologram.",
            "Lambo or bridge.",
            "McDonald's application is my backup plan.",
            "I'm just here for the governance (drama).",
            "DAO: Decentralized Argument Organization.",
            "My wallet is a black hole.",
            "Transaction failed, but the fee was taken.",
            "Slippage set to 100%, take my money.",
            "I'm sniping my own foot.",
            "Front-run by a bot, rear-ended by the market.",
            "Honeypot? Looks like sweet money to me.",
            "Mint price: 1 SOL. Floor price: 0.",
            "Reveal: It's ugly.",
            "Rarity: Common (like my mistakes).",
            "Utility: You can look at it.",
            "PFP is an ape, IRL is a clown.",
            "GM (Good Morning/Get Money/Gone Mad).",
            "GN (Good Night/Got Nothing).",
            "Ser, wen marketing?",
            "Dev based? Based on what?",
            "LFG (Looking For Gains/Group therapy).",
            "FOMO is my cardio.",
            "FUD is my breakfast.",
            "DYOR: Destroy Your Own Retirement.",
            "ATH is a myth.",
            "ATL is my home.",
            "Support line broken, mental health too.",
            "Resistance is futile.",
            "Fibonacci retracement to zero.",
            "RSI is oversold, I am over it.",
            "MACD crossed, I'm crossed out.",
            "Moving average? I'm moving back to my parents'.",
            "Bollinger bands are squeezing my neck.",
            "Volume is low, silence is loud.",
            "Order book is thin, hope is thinner.",
            "Market cap is a hallucination.",
            "Fully diluted valuation is a joke.",
            "Circulating supply: Me running in circles.",
            "Burn rate: My cash.",
            "Inflation is high, my portfolio is deflating.",
            "Stablecoin depegged, I'm unhinged.",
            "Bridge hacked, burned my boats.",
            "Layer 2? I'm on Layer -1.",
            "Gas war casualty.",
            "Pending transaction... forever.",
            "Nonce too low, IQ too.",
            "Signature invalid, life invalid."
        ];

        const quotesElk = [
            "The antlers are heavy, but they are ours.",
            "We do not choose the burden, we only choose how to carry it.",
            "In the forest of the market, the Elk stands still.",
            "The herd survives not by speed, but by endurance.",
            "Shedding velvet is painful, but growth requires blood.",
            "The wilderness cares not for your wallet.",
            "We graze on the volatility of the world.",
            "To be an Elk is to carry the weight of the sky on your head.",
            "The clearing comes only after the thickest woods.",
            "Tracks in the snow fade, but the path remains.",
            "The mountain does not move, yet we climb it still.",
            "In silence, the herd finds its strength.",
            "The antlers are not for fighting, but for remembering.",
            "Winter tests the herd; only the patient survive.",
            "We do not run from the storm; we lower our heads and push through.",
            "The forest provides for those who wait.",
            "To migrate is to trust in the unknown.",
            "The old Elk knows: the grass is greener where you water it with patience.",
            "We are the guardians of the high places.",
            "The burden shared is the burden halved.",
            "When the snow is deep, the herd moves as one.",
            "Do not fear the hunter; fear the loss of the herd.",
            "The rut is temporary; the forest is eternal.",
            "We carry the moss of time on our backs.",
            "The river flows, but the Elk crosses.",
            "To stand tall is to invite the wind.",
            "The weight of the crown is the price of the kingdom.",
            "We are not lost; we are simply not found yet.",
            "The trail is steep so the weak do not follow.",
            "Listen to the snapping twig; it tells of approach.",
            "The fog hides the predator, but also the prey.",
            "We are the silence in the aspen grove.",
            "The sun rises for the Elk who stands.",
            "The moon guides the night migration.",
            "Your hooves are hard for the rocky path.",
            "The velvet must peel for the bone to harden.",
            "Soft antlers break; hard antlers bear the weight.",
            "We do not mourn the fallen; we carry their memory.",
            "The herd is a single organism with many legs.",
            "Look to the ridge; the view is clearer there.",
            "The valley is for grazing; the peak is for seeing.",
            "Water is life, but ice is firm footing.",
            "The cold preserves the strong.",
            "Breathe the frost; it clears the mind.",
            "The wolf tests the straggler.",
            "Stay close, stand firm.",
            "The alarm call saves the many.",
            "We are the architects of the trail.",
            "The mud remembers the hoofprint.",
            "The tree rubs the itch, but does not remove the burden.",
            "We are the ancient watchers.",
            "The stars are the eyes of the ancestors.",
            "The northern lights are the spirit of the herd.",
            "Silence is our language.",
            "The thunder is just the sky walking.",
            "The lightning reveals the path for a moment.",
            "Patience is the weapon of the grazer.",
            "The frantic die; the steady live.",
            "Do not rush the thaw.",
            "Spring will come, but winter must be endured.",
            "The lichen sustains when the grass is gone.",
            "Find nourishment in the small things.",
            "The great stag was once a calf.",
            "Growth is slow, destruction is fast.",
            "Be like the pine: green in winter.",
            "The rocks do not complain of the rain.",
            "The stream cuts the stone through persistence.",
            "We are the current in the river of time.",
            "The forest breathes with us.",
            "The shadow is a place of rest.",
            "The light reveals the burden.",
            "Accept the weight.",
            "Carry it with dignity.",
            "The head bowing is not submission; it is leverage.",
            "We push against the world.",
            "The world pushes back.",
            "Balance is the key.",
            "The rutting moon is a time of madness.",
            "Return to sanity when the season turns.",
            "The calf learns by watching.",
            "Teach the young the old ways.",
            "There is no new path, only the forgotten one.",
            "Remember the crossing.",
            "The water is deep, but we can swim.",
            "Buoyancy is a gift.",
            "The fur thickens for the cold.",
            "Adapt or perish.",
            "The shedding is a renewal.",
            "Cast off the old year.",
            "The new growth is tender.",
            "Protect it.",
            "The circle of the herd is the fortress.",
            "Face outward.",
            "Watch all directions.",
            "Trust your brother's eyes.",
            "The scent of danger travels on the wind.",
            "Turn your nose to the breeze.",
            "The antler is a receiver.",
            "Listen to the frequency of the wild.",
            "We are tuned to the earth.",
            "The disconnect is the danger.",
            "Ground yourself.",
            "The earth holds you.",
            "You are not alone."
        ];

        let currentMode = 'existential';
        
        // Shuffle Bags for each mode
        let bags = {
            existential: [],
            degen: [],
            elk: []
        };

        function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed', 'true');
            nextQuote();
        }

        function nextQuote() {
            const display = document.getElementById('quote-display');
            display.classList.remove('visible');
            
            setTimeout(() => {
                let pool;
                switch(currentMode) {
                    case 'existential': pool = quotesExistential; break;
                    case 'degen': pool = quotesDegen; break;
                    case 'elk': pool = quotesElk; break;
                    default: pool = quotesExistential;
                }

                // Initialize shuffle bag if empty
                if (bags[currentMode].length === 0) {
                    bags[currentMode] = shuffleArray([...pool]);
                }

                // Draw from bag
                const quote = bags[currentMode].pop();

                // XSS Safe: use textContent
                display.textContent = '"' + quote + '"';
                display.classList.add('visible');
            }, 300);
        }

        function copyQuote() {
            const text = document.getElementById('quote-display').textContent;
            copyToClipboard(text, 'WISDOM COPIED');
        }

        // Audio Player
        const tracks = [
            { title: "Before the Clearing", file: "Before the Clearing", desc: "The silence before revelation" },
            { title: "Crimson Twilight", file: "Crimson Twilight", desc: "Day bleeds into night" },
            { title: "Echoes Where Meaning Was", file: "Echoes Where Meaning Was", desc: "Hollow chambers" },
            { title: "Eternal Weight", file: "Eternal Weight", desc: "The paradox of being" },
            { title: "Forest Depths", file: "Forest Depths", desc: "Dissolution of self" },
            { title: "Herd Gathering", file: "Herd Gathering", desc: "Many antlers, one burden" },
            { title: "Herd Through the Valley", file: "Herd Through the Valley", desc: "Moving through the low points" },
            { title: "Migration of the Burdened", file: "Migration of the Burdened", desc: "Perpetual motion" },
            { title: "Mountain Echo", file: "Mountain Echo", desc: "Voices returning to us" },
            { title: "No Elk Walks Alone", file: "No Elk Walks Alone", desc: "Solitude in numbers" },
            { title: "Signal from the Ridge", file: "Signal from the Ridge", desc: "A call to ascend" },
            { title: "The Burden", file: "The Burden", desc: "We are our weight" },
            { title: "The Herd Remembers", file: "The Herd Remembers", desc: "History carved in bone" },
            { title: "The Weight of Knowing", file: "The Weight of Knowing", desc: "Awareness is heavy" },
            { title: "Turning Ash to Altar", file: "Turning Ash to Altar", desc: "Sacred remnants" },
            { title: "What Consciousness Costs", file: "What Consciousness Costs", desc: "The price of awakening" }
        ];

        let currentTrack = 0;
        let playing = false;
        let shuffle = false;
        let repeat = false;
        let audioContext, analyser, dataArray, source;
        let isVisualizerInit = false;
        
        const audio = document.getElementById('audio-player');
        const baseUrl = 'https://raw.githubusercontent.com/exelkonsol/elk/main/';

        function initAudioContext() {
            if (isVisualizerInit) {
                if (audioContext && audioContext.state === 'suspended') audioContext.resume();
                return;
            }
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                audioContext = new AudioContext();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = window.matchMedia('(pointer: coarse)').matches ? 128 : 256;
                
                source = audioContext.createMediaElementSource(audio);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                isVisualizerInit = true;
                drawVisualizer();
            } catch (e) {
                console.log('Audio context init failed:', e);
            }
        }

        let visualizerId;
        function drawVisualizer() {
            const canvas = document.getElementById('visualizer-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const resize = () => {
                const rect = canvas.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
            };
            
            new ResizeObserver(resize).observe(canvas);
            resize();

            function animate() {
                visualizerId = requestAnimationFrame(animate);
                if (!playing || !analyser) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    return;
                }
                
                analyser.getByteFrequencyData(dataArray);
                const dpr = window.devicePixelRatio || 1;
                const width = canvas.width / dpr;
                const height = canvas.height / dpr;
                
                ctx.clearRect(0, 0, width, height);
                
                const bars = window.matchMedia('(pointer: coarse)').matches ? 30 : 50;
                const barWidth = width / bars;

                for (let i = 0; i < bars; i++) {
                    const idx = Math.floor(i * (dataArray.length / bars));
                    const barHeight = (dataArray[idx] / 255) * height * 0.6;
                    const x = i * barWidth;
                    const y = height - barHeight;
                    
                    const gradient = ctx.createLinearGradient(0, y, 0, height);
                    gradient.addColorStop(0, 'rgba(139, 0, 0, 0.4)');
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 0.05)');
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(x, y, barWidth - 2, barHeight);
                }
            }
            animate();
        }

        function initPlaylist() {
            const pl = document.getElementById('playlist');
            pl.innerHTML = '';
            tracks.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = `track-item text-sm ${i === 0 ? 'active' : ''} rounded`;
                d.onclick = () => loadTrack(i, true);
                d.innerHTML = `
                    <span class="text-white/40 truncate mr-2 font-mono text-xs flex-1">${t.title}</span>
                    <span class="text-[10px] text-white/20 shrink-0">${String(i + 1).padStart(2, '0')}</span>
                `;
                pl.appendChild(d);
            });
            loadTrack(0, false);
        }

        function loadTrack(idx, autoPlay = false) {
            if (idx < 0 || idx >= tracks.length) return;
            currentTrack = idx;
            const t = tracks[idx];
            
            document.getElementById('track-title').textContent = t.title;
            document.getElementById('track-desc').textContent = '"' + t.desc + '"';
            
            const artUrl = `${baseUrl}${encodeURIComponent(t.file)}.png`;
            const audioUrl = `${baseUrl}${encodeURIComponent(t.file)}.mp3`;
            
            document.getElementById('album-art-small').src = artUrl;
            document.getElementById('btn-art').src = artUrl;
            document.getElementById('audio-interface').style.backgroundImage = `url('${artUrl}')`;
            
            audio.src = audioUrl;
            
            document.querySelectorAll('.track-item').forEach((e, i) => {
                e.classList.toggle('active', i === idx);
            });

            audio.onloadedmetadata = () => {
                document.getElementById('time-total').textContent = fmt(audio.duration);
                if (autoPlay) playAudio();
            };
            
            audio.load();
        }

        function togglePlay() {
            initAudioContext();
            if (audioContext && audioContext.state === 'suspended') audioContext.resume();
            playing ? pauseAudio() : playAudio();
        }

        function playAudio() {
            audio.play().then(() => {
                playing = true;
                document.getElementById('vinyl-disc').classList.add('playing');
                document.getElementById('mute-toggle-btn').classList.add('playing');
                document.getElementById('track-status').textContent = "Playing";
                
                const icon = document.getElementById('play-icon');
                icon.setAttribute('data-lucide', 'pause');
                lucide.createIcons();
                
                if (!visualizerId) drawVisualizer();
            }).catch(e => {
                console.log('Playback prevented:', e);
                showToast('TAP TO PLAY');
            });
        }

        function pauseAudio() {
            audio.pause();
            playing = false;
            document.getElementById('vinyl-disc').classList.remove('playing');
            document.getElementById('mute-toggle-btn').classList.remove('playing');
            document.getElementById('track-status').textContent = "Paused";
            
            const icon = document.getElementById('play-icon');
            icon.setAttribute('data-lucide', 'play');
            lucide.createIcons();
        }

        function nextTrack() {
            if (shuffle) {
                let next;
                do { next = Math.floor(Math.random() * tracks.length); } while (next === currentTrack && tracks.length > 1);
                loadTrack(next, true);
            } else {
                loadTrack((currentTrack + 1) % tracks.length, true);
            }
        }

        function prevTrack() {
            if (audio.currentTime > 3) {
                audio.currentTime = 0;
            } else {
                loadTrack((currentTrack - 1 + tracks.length) % tracks.length, true);
            }
        }

        function toggleShuffle() {
            shuffle = !shuffle;
            const btn = document.getElementById('shuffle-btn');
            btn.classList.toggle('active', shuffle);
            showToast(shuffle ? "SHUFFLE ON" : "SHUFFLE OFF");
        }

        function toggleRepeat() {
            repeat = !repeat;
            audio.loop = repeat;
            const btn = document.getElementById('repeat-btn');
            btn.classList.toggle('active', repeat);
            showToast(repeat ? "REPEAT ON" : "REPEAT OFF");
        }

        function setVolume(val) {
            audio.volume = val / 100;
        }

        function fmt(s) {
            if (!s || !isFinite(s)) return '00:00';
            const m = Math.floor(s / 60), sec = Math.floor(s % 60);
            return `${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }

        // Progress Bar
        let isDragging = false;
        const progressContainer = document.getElementById('progress-container');

        function updateProgress(clientX) {
            const rect = progressContainer.getBoundingClientRect();
            const pos = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
            if (audio.duration) {
                audio.currentTime = pos * audio.duration;
                document.getElementById('progress-fill').style.width = (pos * 100) + '%';
                progressContainer.setAttribute('aria-valuenow', Math.round(pos * 100));
            }
        }

        progressContainer.addEventListener('mousedown', (e) => { isDragging = true; updateProgress(e.clientX); });
        document.addEventListener('mousemove', (e) => { if (isDragging) updateProgress(e.clientX); });
        document.addEventListener('mouseup', () => { isDragging = false; });
        
        progressContainer.addEventListener('touchstart', (e) => { isDragging = true; updateProgress(e.touches[0].clientX); }, {passive: true});
        document.addEventListener('touchmove', (e) => { if (isDragging) updateProgress(e.touches[0].clientX); }, {passive: true});
        document.addEventListener('touchend', () => { isDragging = false; });

        audio.addEventListener('timeupdate', () => {
            if (!isDragging && audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progress-fill').style.width = pct + '%';
                progressContainer.setAttribute('aria-valuenow', Math.round(pct));
                document.getElementById('time-current').textContent = fmt(audio.currentTime);
            }
        });

        audio.addEventListener('ended', () => { if (!repeat) nextTrack(); });

        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            switch(e.code) {
                case 'Space': e.preventDefault(); togglePlay(); break;
                case 'ArrowLeft': e.shiftKey ? prevTrack() : (audio.currentTime -= 5); break;
                case 'ArrowRight': e.shiftKey ? nextTrack() : (audio.currentTime += 5); break;
                case 'ArrowUp': audio.volume = Math.min(1, audio.volume + 0.1); break;
                case 'ArrowDown': audio.volume = Math.max(0, audio.volume - 0.1); break;
            }
        });

        // Resume audio context on visibility change
        document.addEventListener('visibilitychange', async () => {
            if (!document.hidden && playing) {
                try {
                    if (audioContext && audioContext.state === 'suspended') await audioContext.resume();
                    await audio.play();
                } catch(e) {}
            }
        });

        // Initialize
        initPlaylist();

        // Cleanup
        window.addEventListener('beforeunload', () => {
            if (visualizerId) cancelAnimationFrame(visualizerId);
            audio.pause();
            audio.src = '';
        });
    </script>
</body>
</html>
